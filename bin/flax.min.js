PTM_RATIO=32;RADIAN_TO_DEGREE=180/Math.PI;DEGREE_TO_RADIAN=Math.PI/180;IMAGE_TYPES=[".png",".jpg",".bmp",".jpeg",".gif"];SOUND_TYPES=[".mp3",".ogg",".wav",".mp4",".m4a"];DEFAULT_SOUNDS_FOLDER="res/music/";H_ALIGHS=["left","center","right"];RESET_FRAME_ON_RECYCLE=!0;var TileValue=TileValue||{WALKABLE:0,BLOCK1:1,BLOCK2:2,BLOCK3:3,BLOCK4:4,BLOCK5:5},flax=flax||{};window.flax=flax;flax.version=2.3;flax.gameVersion=0;flax.minToolVersion=2;flax.language=null;flax.languageIndex=-1;flax.languages="zh en de fr it es tr pt ru".split(" ");
flax.landscape=!1;flax.stageRect=null;flax.designedStageSize=null;flax.osVersion="unknown";flax.assetsManager=null;flax.inputManager=null;flax.mousePos=null;flax.currentSceneName=null;flax.currentScene=null;flax.prevSceneName=null;flax.buttonSound=null;flax.frameInterval=1/60;flax.pointZero={x:0,y:0};flax._scenesDict={};flax._soundEnabled=!0;flax._inited=!1;flax._orientationTip=null;flax._languageDict=null;flax._languageToLoad=null;flax.onDeviceRotate=null;flax.onScreenResize=null;
flax.onSceneExit=null;flax.onSceneEnter=null;flax._addResVersion=function(a){return cc.sys.isNative||"string"!=typeof a||flax.isSoundFile(a)||-1<a.indexOf("?v\x3d")?a:a+"?v\x3d"+(flax.gameVersion||cc.game.config.version)};flax._removeResVersion=function(a){if(cc.sys.isNative||"string"!=typeof a||flax.isSoundFile(a))return a;var b=a.indexOf("?v\x3d");-1<b&&(a=a.substr(0,b));return a};
flax.isDomainAllowed=function(){if(cc.sys.isNative)return!0;var a=document.domain,b=cc.game.config.domainAllowed;return flax.isLocalDebug()||null==b||0==b.length||-1<b.indexOf(a)};flax.isLocalDebug=function(){if(cc.sys.isNative)return!1;var a=document.domain;return"localhost"==a||0==a.indexOf("192.168.")};
if(!cc.sys.isNative&&(flax.isLocalDebug()&&(flax.gameVersion=1+Math.floor(999998*Math.random())),setTimeout(function(){var a=document.body.style.backgroundColor;document.getElementById(cc.game.config.id).style.backgroundColor=a;a=a.replace("rgb(","");a=a.replace(")","");a=a.split(",");flax.bgColor=cc.color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))},0.01),cc.sys.isMobile)){var __hideBottomBar=function(){document.body.scrollTop=0},orientationEvent="onorientationchange"in window?"orientationchange":
"resize";window.addEventListener(orientationEvent,__hideBottomBar,!0);__hideBottomBar()}
flax.init=function(a,b,c){if(!flax._inited){flax._inited=!0;cc.log("Flax inited, version: "+flax.version);null==a&&(a=cc.sys.isMobile?cc.ResolutionPolicy.NO_BORDER:cc.ResolutionPolicy.SHOW_ALL);flax.fetchUserData&&flax.fetchUserData(b);flax._checkOSVersion();b=c?c.width:cc.game.config.width;c=c?c.height:cc.game.config.height;if(!b||!c)throw"Please set the game width and height in the project.json!";if(cc.sys.isNative)cc.view.setDesignResolutionSize(b,c,a);else{var d=document.getElementById(cc.game.config.id);
d.width=b=b||d.width;d.height=c=c||d.height;cc.view.adjustViewPort(!0);cc.view.setDesignResolutionSize(b,c,a);cc.view.resizeWithBrowserSize(!0)}flax.designedStageSize=cc.size(b,c);flax.frameInterval=1/cc.game.config.frameRate;flax.assetsManager=flax.AssetsManager.create();a=cc.game.config.language;null==a||""==a?null==flax.language&&(a=cc.sys.language,flax.updateLanguage(a)):flax.updateLanguage(a);flax.stageRect=cc.rect(cc.visibleRect.bottomLeft.x,cc.visibleRect.bottomLeft.y,cc.visibleRect.width,
cc.visibleRect.height);flax.onDeviceRotate=new signals.Signal;flax.onScreenResize=new signals.Signal;flax.onSceneExit=new signals.Signal;flax.onSceneEnter=new signals.Signal;cc.sys.isNative||window.addEventListener("resize",function(){flax.stageRect=cc.rect(cc.visibleRect.bottomLeft.x,cc.visibleRect.bottomLeft.y,cc.visibleRect.width,cc.visibleRect.height);flax.onScreenResize.dispatch()},!1)}};
flax.getLanguageStr=function(a,b){if(null==flax._languageDict)return cc.log("Warning: there is no language defined: "+flax.language),null;var c=flax._languageDict[a];if(null==c)cc.log("Warning: there is no language string for key: "+a);else if(b)for(a in b)c=c.replace(RegExp("{"+a+"}","g"),b[a]);return c};
flax.updateLanguage=function(a){null!=a&&""!=a&&a!=flax.language&&(flax.language=a,cc.game.config.languages&&cc.game.config.languages.length&&(flax.languages=cc.game.config.languages),flax.languageIndex=flax.languages.indexOf(a),-1==flax.languageIndex&&cc.log("Invalid language: "+a),cc.game.config.languageJson&&(flax._languageToLoad=flax._getLanguagePath(a)))};flax._getLanguagePath=function(a){return"res/locale/"+(a||flax.language)+".json"};
flax.createDisplay=function(a,b,c,d,e){return flax.assetsManager.createDisplay(a,b,c,d,e)};flax.addListener=function(a,b,c,d){flax.inputManager.addListener(a,b,c,d)};flax.removeListener=function(a,b,c){flax.inputManager.removeListener(a,b,c)};
flax.addModule=function(a,b,c){if(null==b)throw"Module can not be null!";for(var d in b)if(0==d.indexOf("on")){var e="__"+d,f=e+"Num";void 0===a.prototype[f]?a.prototype[f]=0:a.prototype[f]++;a.prototype[e+a.prototype[f]]=b[d]}else!0!==c&&a.prototype[d]||(a.prototype[d]=b[d])};flax.callModuleFunction=function(a,b,c){b="__"+b;var d=a[b+"Num"];if(void 0!==d)for(;0<=d;)a[b+d](c),d--;else if(a[b])a[b](c)};flax.callModuleOnEnter=function(a){flax.callModuleFunction(a,"onEnter")};
flax.callModuleOnExit=function(a){flax.callModuleFunction(a,"onExit")};flax._checkOSVersion=function(){if(!cc.sys.isNative){var a=navigator.userAgent,b;a.match(/iPad/i)||a.match(/iPhone/i)?(b=a.indexOf("OS "),cc.sys.os=cc.sys.OS_IOS,-1<b&&(flax.osVersion=a.substr(b+3,3).replace("_","."))):a.match(/Android/i)&&(b=a.indexOf("Android "),cc.sys.os=cc.sys.OS_ANDROID,-1<b&&(flax.osVersion=a.substr(b+8,3)))}};
flax.registerScene=function(a,b,c){c||(c=[]);c instanceof Array||(c=[c]);flax._scenesDict[a]={scene:b,res:c}};
flax.replaceScene=function(a,b,c){if(flax.isDomainAllowed()){flax.currentSceneName&&flax.onSceneExit.dispatch(flax.currentSceneName);flax.ObjectPool&&flax.ObjectPool.release();flax.BulletCanvas&&flax.BulletCanvas.release();cc.director.resume();flax.prevSceneName=flax.currentSceneName;flax.currentSceneName=a;flax.stopPhysicsWorld&&flax.stopPhysicsWorld();flax.inputManager&&flax.inputManager.removeFromParent();flax.clearDraw&&flax.clearDraw(!0);var d=flax._scenesDict[a];if(null==d)throw"Please register the scene: "+
a+" firstly!";flax._languageToLoad&&-1==d.res.indexOf(flax._languageToLoad)&&d.res.push(flax._languageToLoad);if(flax._fontResources)for(var e in flax._fontResources)d.res.push({type:"font",name:e,srcs:flax._fontResources[e]});flax.preload(d.res,function(){if(flax._languageToLoad){flax._languageDict=cc.loader.getRes(flax._getLanguagePath());var a=d.res.indexOf(flax._languageToLoad);-1<a&&d.res.splice(a,1);flax._languageToLoad=null}if(flax._fontResources){for(a=d.res.length;a--;)"object"==typeof d.res[a]&&
d.res.splice(a,1);flax._fontResources=null}flax.currentScene=new d.scene;a=!1;if(b){if(!c||0>c)c=0.5;var e=b.create(c,flax.currentScene);e&&(a=!0,cc.director.runScene(e))}a||cc.director.runScene(flax.currentScene);flax.inputManager=new flax.InputManager;flax.currentScene.addChild(flax.inputManager,999999);flax._checkDeviceOrientation();flax.onSceneEnter.dispatch(flax.currentSceneName)})}};flax.refreshScene=function(){flax.currentSceneName&&flax.replaceScene(flax.currentSceneName)};
flax._soundResources={};
flax.preload=function(a,b,c,d){if(null!=a&&0!=a.length){"string"===typeof a&&(a=[a]);for(var e=!1,f=[],g=a.length;g--;){var k=a[g];if(null==k)throw"There is a null resource!";if(null==cc.loader.getRes(k)&&null==flax._soundResources[k])if("string"!=typeof k||".flax"!=cc.path.extname(k)||!cc.sys.isNative&&!1!==cc.game.config.useFlaxRes)e=!0,f.unshift(flax._addResVersion(k));else{cc.sys.isNative&&cc.log("***Warning: .flax is not support JSB for now, use .plist + .png insteadly!");var l=cc.path.changeBasename(k,
".plist"),k=cc.path.changeBasename(k,".png");null==cc.loader.getRes(k)&&(f.unshift(flax._addResVersion(l)),f.unshift(flax._addResVersion(k)),e=!0)}}if(e){var n=flax.nameToObject(cc.game.config.preloader||"flax.Preloader");!0===c&&(n=flax.ResPreloader);n=new n;n.initWithResources(f,function(){!0===c&&(flax.inputManager.removeMask(n),n.removeFromParent());if(!cc.sys.isNative)for(var a=f.length;a--;){var e=f[a];flax.isSoundFile(e)&&(flax._soundResources[e]="loaded");var k=cc.loader.getRes(e);if(k){var g=
flax._removeResVersion(e);cc.loader.cache[g]=k;flax.isImageFile(g)&&cc.sys.capabilities.opengl&&cc.textureCache.handleLoadedTexture(g);cc.loader.release(e)}}b.apply(d)});!0===c?(flax.currentScene.addChild(n,999999),flax.inputManager.addMask(n)):cc.director.runScene(n);return n}}b.apply(d)};
flax.setSoundEnabled=function(a){if(flax._soundEnabled!=a){flax._soundEnabled=a;var b=cc.audioEngine;a?(b.resumeMusic(),flax._lastMusic&&(flax.playMusic(flax._lastMusic,!0),flax._lastMusic=null)):(b.pauseMusic(),b.stopAllEffects())}};flax.getSoundEnabled=function(){return flax._soundEnabled};flax._lastMusic=null;flax.playMusic=function(a,b,c){var d=cc.audioEngine;d.stopMusic(!0===c);flax._soundEnabled?d.playMusic(a,b):flax._lastMusic=a};flax.stopMusic=function(a){cc.audioEngine.stopMusic(!0===a)};
flax.pauseMusic=function(){cc.audioEngine.pauseMusic()};flax.resumeMusic=function(){cc.audioEngine.resumeMusic()};flax.playEffect=function(a){if(flax._soundEnabled)return cc.audioEngine.playEffect(a)};flax.stopEffect=function(a){var b=cc.audioEngine;null!=a?b.stopEffect(a):b.stopAllEffects()};flax.playSound=function(a){return flax.playEffect(a)};
flax._checkDeviceOrientation=function(){if(!cc.sys.isNative){if(!flax._orientationTip&&cc.sys.isMobile){if(cc.game.config.rotateImg){flax._orientationTip=cc.LayerColor.create(flax.bgColor,cc.visibleRect.width+10,cc.visibleRect.height+10);var a=new cc.Sprite(cc.game.config.rotateImg);a.setPosition(cc.visibleRect.center);flax._orientationTip.__icon=a;flax._orientationTip.addChild(a)}window.addEventListener("onorientationchange"in window?"orientationchange":"resize",flax._showOrientaionTip,!0);flax._showOrientaionTip()}flax._orientationTip&&
(flax._orientationTip.removeFromParent(),flax.currentScene.addChild(flax._orientationTip,Number.MAX_VALUE))}};flax._oldGamePauseState=!1;
flax._showOrientaionTip=function(){var a=90==Math.abs(window.orientation),b=cc.game.config.landscape;flax._orientationTip&&(flax._orientationTip.visible=b!=a,flax._orientationTip.__icon.rotation=a?-90:0,document.body.scrollTop=0,flax._orientationTip.visible?(flax.landscape!=a&&(flax._oldGamePauseState=cc.director.isPaused()),cc.director.pause()):flax._oldGamePauseState||cc.director.resume(),flax.inputManager.enabled=!flax._orientationTip.visible);flax.landscape=a;b==a?cc.view.setDesignResolutionSize(flax.designedStageSize.width,
flax.designedStageSize.height,cc.view.getResolutionPolicy()):cc.view.setDesignResolutionSize(flax.designedStageSize.height,flax.designedStageSize.width,cc.view.getResolutionPolicy());flax.stageRect=cc.rect(cc.visibleRect.bottomLeft.x,cc.visibleRect.bottomLeft.y,cc.visibleRect.width,cc.visibleRect.height);flax.onDeviceRotate.dispatch(flax.landscape)};flax.getAngle=function(a,b,c){var d=0,e=0;a&&(d=a.x,e=a.y);return flax.getAngle1(b.x-d,b.y-e,c)};
flax.getAngle1=function(a,b,c){void 0===c&&(c=!0);a=Math.atan2(a,b);0>a&&(a+=2*Math.PI);c&&(a*=RADIAN_TO_DEGREE);return a};flax.getDistance=function(a,b){var c=b.x-(null==a?0:a.x),d=b.y-(null==a?0:a.y);return Math.sqrt(c*c+d*d)};flax.getPointOnCircle=function(a,b,c){c=(90-c)*DEGREE_TO_RADIAN;var d=a?a.y:0;return{x:(a?a.x:0)+b*Math.cos(c),y:d+b*Math.sin(c)}};
flax.getPosition=function(a,b){var c=a.getPosition();a.parent&&(b&&(c=a.parent.convertToWorldSpace(c)),b instanceof cc.Sprite&&(c=b.convertToNodeSpace(c)));return c};flax.getRotation=function(a,b){if(!1==b)return a.rotation;for(var c=0,d=a;d&&(c+=d.rotation,d=d.parent,d!==b););return c};flax.getScale=function(a,b){if(!1==b)return{x:a.scaleX,y:a.scaleY};for(var c=1,d=1,e=a;e&&(c*=e.scaleX,d*=e.scaleY,e=e.parent,e!==b););return{x:c,y:d}};
flax.getRect=function(a,b){var c;if(a.getRect)return c=a.getRect(b);if((a instanceof cc.Layer||a instanceof cc.Scene)&&!(cc.EditBox&&a instanceof cc.EditBox))return flax.stageRect;null==b&&(b=!0);c=a.getContentSize();var d=flax.getScale(a,b),e=a.getPosition();if(a.parent)if(b)b!=a.parent&&(e=a.parent.convertToWorldSpace(e),b instanceof cc.Node&&(e=b.convertToNodeSpace(e)));else return c.width*=Math.abs(d.x),c.height*=Math.abs(d.y),cc.rect(0,0,c.width,c.height);var f=a.getAnchorPoint();return c=cc.rect(e.x-
c.width*d.x*f.x,e.y-c.height*d.y*f.y,c.width*Math.abs(d.x),c.height*Math.abs(d.y))};flax._strToRect=function(a){a=a.split(",");return cc.rect(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};flax.ifTouched=function(a,b){if(null==a||!(a instanceof cc.Node))return!1;if(a.mainCollider)return a.mainCollider.containsPoint(b);var c=flax.getRect(a,!0);return cc.rectContainsPoint(c,b)};flax.ifCollide=function(a,b){return a.mainCollider.checkCollision(b.mainCollider)};
flax.isFlaxDisplay=function(a){return a instanceof flax.FlaxSprite||a instanceof flax.FlaxSpriteBatch||a instanceof flax.Image||flax.Scale9Image&&a instanceof flax.Scale9Image};flax.isFlaxSprite=function(a){return a instanceof flax.FlaxSprite||a instanceof flax.FlaxSpriteBatch};flax.isMovieClip=function(a){return a instanceof flax.MovieClip||a instanceof flax.MovieClipBatch};flax.isButton=function(a){return a instanceof flax.Button||a instanceof flax.SimpleButton};
flax.isChildOf=function(a,b){if(null==a||null==b||a==b)return!1;for(var c=a.parent;c;){if(c==b)return!0;c=c.parent}return!1};flax.findParentWithClass=function(a,b){for(var c=a;c;){if(c instanceof b)return c;c=c.parent}return null};flax.findChildWithClass=function(a,b){for(var c=a.children,d=c.length,e;d--;)if(e=c[d],e instanceof b||(e=flax.findChildWithClass(e,b)))return e;return null};
flax.getUrlVars=function(){var a={};if(cc.sys.isNative)return a;for(var b=window.location.search.substring(1).split("\x26"),c=0;c<b.length;c++){var d=b[c].split("\x3d");a[d[0]]=decodeURIComponent(d[1])}return a};flax.nameToObject=function(a,b){if(void 0==a||""==a)return null;b=b||"function";for(var c=a.split("."),d=window||this,e=0,f=c.length;e<f;e++)try{d=d[c[e]]}catch(g){break}return typeof d!==b?null:d};
flax.createBGLayer=function(a,b){null==b&&(b=cc.color(255,255,255,255));var c=cc.LayerColor.create(b,cc.visibleRect.width,cc.visibleRect.height);a.addChild(c,0);return c};flax.shuffleArray=function(a,b){if(void 0===b||0>=b||b>a.length)b=a.length;for(var c=b-1;0<=c;c--){var d=0|cc.rand()%(c+1),e=a[c];a[c]=a[d];a[d]=e}};flax.restrictValue=function(a,b,c){a=Math.max(b,a);return a=Math.min(c,a)};flax.numberSign=function(a){return 0==a?0:0<a?1:-1};
flax.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a))};flax.getRandomInArray=function(a,b){if(null==a)return null;if(null==b){var c=flax.randInt(0,a.length);return a[c]}for(var d=Math.random(),e=0,c=0;c<b.length&&(0>=b[c]||(e+=b[c],!(d<=e)));c++);return a[c]};flax.isImageFile=function(a){if("string"!=typeof a)return!1;a=cc.path.extname(a);return-1<IMAGE_TYPES.indexOf(a)};flax.isSoundFile=function(a){if("string"!=typeof a)return!1;a=cc.path.extname(a);return-1<SOUND_TYPES.indexOf(a)};
flax.copyProperties=function(a,b){if(null!=a&&null!=b)for(var c in a)try{b[c]=a[c]}catch(d){}};flax.createDInts=function(a,b){isNaN(b)&&(b=0);for(var c=[],d=-1,e=b-1,f=b;++d<a;)0==d%2?c.push(++e):c.push(--f);return c};
flax.utf8ToUnicode=function(a){if(a){for(var b="",c=a.length,d=0,e=c,f,g,k;d<c;)if(f=a.charCodeAt(d),0==(f&128)){if(1>e)break;b+=String.fromCharCode(f&127);d++;e-=1}else if(192==(f&224)){g=a.charCodeAt(d+1);if(2>e||128!=(g&192))break;b+=String.fromCharCode((f&63)<<6|g&63);d+=2;e-=2}else if(224==(f&240)){g=a.charCodeAt(d+1);k=a.charCodeAt(d+2);if(3>e||128!=(g&192)||128!=(k&192))break;b+=String.fromCharCode((f&15)<<12|(g&63)<<6|k&63);d+=3;e-=3}else break;return 0!=e?"":b}};
flax.formatTime=function(a,b){if(1>=b)return a+"";b||(b=2);var c=0;2<b&&(c=Math.floor(a/3600));var d=Math.floor((a-3600*c)/60),e=a-3600*c-60*d;10>c&&(c="0"+c);10>d&&(d="0"+d);10>e&&(e="0"+e);return 2<b?c+":"+d+":"+e:d+":"+e};
flax.generateUid=function(a,b){var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[],e;b=b||c.length;if(a)for(e=0;e<a;e++)d[e]=c[0|Math.random()*b];else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(e=0;36>e;e++)d[e]||(f=0|16*Math.random(),d[e]=c[19==e?f&3|8:f])}return d.join("")};flax.homeUrl="http://flax.so";flax.goHomeUrl=function(){var a=cc.game.config.homeUrl||flax.homeUrl;!cc.sys.isNative&&a&&window.open(a)};function SignalBinding(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}
SignalBinding.prototype={actived:!0,params:null,execute:function(a){var b;this.actived&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},
_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", actived:"+this.actived+"]"}};function validateListener(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function Signal(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){Signal.prototype.dispatch.apply(a,arguments)}}
Signal.prototype={VERSION:"::VERSION_NUMBER::",memorize:!1,_shouldPropagate:!0,actived:!0,_registerListener:function(a,b,c,d){var e=this._indexOfListener(a,c);if(-1!==e){if(a=this._bindings[e],a.isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.");}else a=new SignalBinding(this,a,b,c,d),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){var b=
this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){validateListener(a,"add");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){validateListener(a,"addOnce");return this._registerListener(a,!0,
b,c)},remove:function(a,b){validateListener(a,"remove");var c=this._indexOfListener(a,b);-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.actived){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=
b);if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.actived+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal;(function(a){"function"===typeof define&&define.amd?define(function(){return signals}):"undefined"!==typeof module&&module.exports?module.exports=signals:a.signals=signals})(this);flax.__drawNode=null;flax.createDrawNode=function(a,b){flax.__drawNode&&flax.__drawNode.parent&&!a||(null==flax.__drawNode&&(flax.__drawNode=cc.DrawNode.create()),flax.currentScene&&(a||(a=flax.currentScene),flax.__drawNode.parent&&flax.__drawNode.parent!=a&&(flax.__drawNode.removeFromParent(),flax.__drawNode.clear()),null==flax.__drawNode.parent&&a.addChild(flax.__drawNode),flax.__drawNode.zIndex=b||99999))};
flax.clearDraw=function(a){null!=flax.__drawNode&&(flax.__drawNode.clear(),!0===a&&(flax.__drawNode.removeFromParent(),flax.__drawNode=null))};flax.drawLine=function(a,b,c,d){flax.createDrawNode();null==c&&(c=1);null==d&&(d=cc.color(255,0,0,255));flax.__drawNode.drawSegment(a,b,c,d)};flax.drawRay=function(a,b,c,d,e){flax.drawLine(a,flax.getPointOnCircle(a,c,b),d,e)};
flax.drawRect=function(a,b,c,d){flax.createDrawNode();null==b&&(b=1);null==c&&(c=cc.color(255,0,0,255));var e=cc.pAdd(cc.p(a.x,a.y),cc.p(a.width,a.height));flax.__drawNode.drawRect(cc.p(a.x,a.y),e,d,b,c)};flax.drawStageRect=function(){var a=h=2;flax.drawRect(cc.rect(flax.stageRect.x+a,flax.stageRect.y+h,flax.stageRect.width-2*a,flax.stageRect.height-2*h))};
flax.drawCircle=function(a,b,c,d){flax.createDrawNode();null==c&&(c=1);null==d&&(d=cc.color(255,0,0,255));flax.__drawNode.drawCircle(a,b,360,360,!1,c,d)};flax.drawDot=function(a,b,c){flax.createDrawNode();null==b&&(b=3);null==c&&(c=cc.color(255,0,0,255));flax.__drawNode.drawDot(a,b,c)};var InputType={press:"onPress",up:"onUp",click:"onClick",move:"onMouseMove",keyPress:"onKeyPress",keyUp:"onKeyUp"};
flax.InputManager=cc.Node.extend({enabled:!0,inTouching:!1,inDragging:!1,justDragged:!1,justDragDist:0,_masks:[],_callbacks:{},_keyboardCallbacks:{},_keyboardListener:null,_touchListeners:null,ctor:function(){cc.Node.prototype.ctor.call(this);this._masks=[];this.inTouching=!1;this._callbacks={};this._keyboardCallbacks={};this._keyboardListener=null;this._touchListeners={}},onEnter:function(){this._super();var a=this;if(!cc.sys.isMobile){var b=cc.EventListener.create({event:cc.EventListener.MOUSE,
onMouseMove:function(b){a.inDragging=0==b.getButton();if(a.justDragged=a.inDragging)a.justDragDist+=cc.pLength(b.getDelta());a.inDragging||a._dispatchOne(a,b,{target:a,currentTarget:a},InputType.move);flax.mousePos=b.getLocation()}});cc.eventManager.addListener(b,this)}b=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(b,d){flax.mousePos=b.getLocation();if(!a.enabled)return!1;a.inDragging=!1;a.justDragged=!1;a.justDragDist=0;a.inTouching=!0;
a._dispatchOne(a,b,d,InputType.press);return!0},onTouchEnded:function(b,d){a.inDragging=!1;a.inTouching=!1;a._dispatchOne(a,b,d,InputType.up);a._dispatchOne(a,b,d,InputType.click)},onTouchMoved:function(b,d){flax.mousePos=b.getLocation();a.inDragging=!0;a.justDragged=!0;a.justDragDist+=cc.pLength(b.getDelta());a._dispatchOne(a,b,d,InputType.move)}});cc.eventManager.addListener(b,this)},onExit:function(){this._super();this.removeAllTouchListeners();this.removeAllKeyboardListeners();this.removeAllMasks()},
addMask:function(a){-1<this._masks.indexOf(a)||(this._masks.push(a),a.__isInputMask=!0)},removeMask:function(a){var b=this._masks.indexOf(a);-1<b&&(this._masks.splice(b,1),a.__isInputMask=!1)},removeAllMasks:function(){for(var a=this._masks.length;a--;)this._masks[a].__isInputMask=!1,this._masks.splice(a,1);this._masks.length=0},_compareRealZIndex:function(a,b){if(!a.parent||!b.parent)return 1;if(a.parent==b.parent)return this._childIsOnFront(a,b);for(var c=null,d=0,e=[],f=a.parent;f;)e.push(f),f=
f.parent;for(var g=[],f=b.parent;f;){d=e.indexOf(f);if(-1<d){c=f;break}g.push(f);f=f.parent}e=e.slice(0,d);return this._childIsOnFront(e[e.length-1]||a,g[g.length-1]||b,c)?1:-1},_childIsOnFront:function(a,b,c){null==c&&(c=a.parent);return c.children.indexOf(a)>c.children.indexOf(b)},addListener:function(a,b,c,d){if(null==b)throw"Event callback can not be null!";var e=c==InputType.keyPress||c==InputType.keyUp;null==a&&(a=this,e||cc.log("Listening target is null, make sure you want to listen to the full screen input!"));
if(e){e=this._keyboardCallbacks[c];null==e&&(e=[],this._keyboardCallbacks[c]=e);for(var f=e.length;f--;)if(e[f].func==b)return;e.push({func:b,context:d||a});this._keyboardListener||this._createKeyboardListener()}else{c=null==c?InputType.click:c;null==a.__instanceId&&(a.__instanceId=ClassManager.getNewInstanceId());e=this._callbacks[a.__instanceId];null==e&&(e=[],this._callbacks[a.__instanceId]=e,a!=this&&(f=this._createListener(a,!0),this._touchListeners[a.__instanceId]=f));for(f=e.length;f--;)if(e[f].type==
c&&e[f].func==b)return;e.push({type:c,func:b,context:d||a})}},removeListener:function(a,b,c){null==a&&(a=this);var d=this._callbacks[a.__instanceId];if(d&&(null==c||c!=InputType.keyPress&&c!=InputType.keyUp)){var e=null,f=d.length;if(b||c)for(;f--;)e=d[f],c&&e.type!=c||b&&e.func!=b||d.splice(f,1);if(0==d.length||!b&&!c)delete this._callbacks[a.__instanceId],this._touchListeners[a.__instanceId]&&delete this._touchListeners[a.__instanceId]}if(b&&(null==c||c==InputType.keyPress||c==InputType.keyUp)&&
(null==c?(d=this._keyboardCallbacks[InputType.keyPress]||[],d=d.concat(this._keyboardCallbacks[InputType.keyUp]||[])):d=this._keyboardCallbacks[c],d&&d.length))for(f=d.length;f--;)e=d[f],e.func==b&&d.splice(f,1)},removeAllTouchListeners:function(){this._callbacks={};for(var a in this._touchListeners)cc.eventManager.removeListener(this._touchListeners[a]),delete this._touchListeners[a]},removeAllKeyboardListeners:function(){this._keyboardCallbacks={};this._keyboardListener&&(this._keyboardListener=
null)},handleTouchBegan:function(a,b){if(!this.enabled)return!1;var c=b.getCurrentTarget();if(this._ifTargetIgnore(c,a))return!1;var d=a.getLocation();if(!this._ifNotMasked(c,d))return!1;b.currentTarget=c;b.target=this._findRealTarget(c,d)||c;if((c instanceof cc.Layer||c instanceof flax.MovieClip)&&b.target==c)return!1;this._dispatch(c,a,b,InputType.press);return!0},handleTouchEnded:function(a,b){var c=b.getCurrentTarget();b.currentTarget=c;b.target=this._findRealTarget(c,a.getLocation())||c;this._dispatch(c,
a,b,InputType.up);flax.ifTouched(c,a.getLocation())&&this._dispatch(c,a,b,InputType.click)},handleTouchMoved:function(a,b){var c=b.getCurrentTarget();this._dispatch(c,a,b,InputType.move)},_createListener:function(a,b){var c=this,d=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:b,onTouchBegan:function(a,b){return c.handleTouchBegan(a,b)},onTouchEnded:function(a,b){c.handleTouchEnded(a,b)},onTouchMoved:function(a,b){c.handleTouchMoved(a,b)},onTouchCancelled:function(a,
b){c.handleTouchEnded(a,b)}});cc.eventManager.addListener(d,a);return d},_createKeyboardListener:function(){var a=this;this._keyboardListener={event:cc.EventListener.KEYBOARD,onKeyPressed:function(b,c){a._dispatchKeyboardEvent(b,InputType.keyPress)},onKeyReleased:function(b,c){a._dispatchKeyboardEvent(b,InputType.keyUp)}};cc.eventManager.addListener(this._keyboardListener,this)},_ifNotMasked:function(a,b){for(var c=this._masks.length,d=null,d=null;c--;)if(d=this._masks[c],a!=d&&!flax.isChildOf(a,
d)&&!flax.isChildOf(d,a)&&!this._ifTargetIgnore(d)&&1==this._compareRealZIndex(d,a)&&(d=this._findRealTarget(d,b)))return!1;return!0},_findRealTarget:function(a,b){a instanceof Array||(a=[a]);for(var c=null,d=a.length;d--;)if(c=a[d],!this._ifTargetIgnore(c)){if(0<c.children.length&&(this._temp=this._findRealTarget(c.children,b)))return this._temp;if(flax.ifTouched(c,b))return c}return null},_ifTargetIgnore:function(a,b){return null==a||!(a instanceof cc.Scene||a.parent)||!this._ifTargetVisible(a)||
a.isMouseEnabled&&!1===a.isMouseEnabled()||b&&!flax.ifTouched(a,b.getLocation())?!0:!1},_ifTargetVisible:function(a){for(;a;){if(!a.visible)return!1;a=a.parent}return!0},_dispatch:function(a,b,c,d){for(var e=[];a;){var f=this._callbacks[a.__instanceId];f&&f.length&&e.push(a);a=a.parent}for(f=0;f<e.length;f++)a=e[f],this._dispatchOne(a,b,c,d)},_dispatchOne:function(a,b,c,d){var e=this._callbacks[a.__instanceId];if(e&&e.length){c.currentTarget=a;c.inputType=d;a=null;for(var f=[],g=e.length;g--;)a=e[g],
a.type==d&&f.push(a);for(g=f.length;g--;)a=f[g],a.func.apply(a.context,[b,c])}},_dispatchKeyboardEvent:function(a,b){var c=this._keyboardCallbacks[b];if(c&&c.length){for(var d=this._getNativeKeyName(a),e=null,f=[],g=c.length;g--;)e=c[g],f.push(e);for(g=f.length;g--;)e=f[g],e.func.apply(e.context,[d])}},_getNativeKeyName:function(a){var b=Object.getOwnPropertyNames(flax.KEY),c="",d;for(d in b)if(flax.KEY[b[d]]==a){c=b[d];break}return c}});
flax.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,
"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"\x3d":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1E3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};/*
 zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
(function(){function a(a,b){var c=a.split("."),d=g;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function b(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,l,n,m,p,r,u;for(r=0;r<b;++r)a[r]>c&&(c=a[r]),a[r]<d&&(d=a[r]);e=1<<c;f=new (k?Uint32Array:Array)(e);g=1;l=0;for(n=2;g<=c;){for(r=0;r<b;++r)if(a[r]===g){m=0;p=l;for(u=0;u<g;++u)m=m<<1|p&1,p>>=1;p=g<<16|r;for(u=m;u<e;u+=n)f[u]=p;++l}++g;l<<=1;n<<=1}return[f,
c,d]}function c(a,b){this.g=[];this.h=32768;this.c=this.f=this.d=this.k=0;this.input=k?new Uint8Array(a):a;this.l=!1;this.i=n;this.q=!1;if(b||!(b={}))b.index&&(this.d=b.index),b.bufferSize&&(this.h=b.bufferSize),b.bufferType&&(this.i=b.bufferType),b.resize&&(this.q=b.resize);switch(this.i){case l:this.a=32768;this.b=new (k?Uint8Array:Array)(32768+this.h+258);break;case n:this.a=0;this.b=new (k?Uint8Array:Array)(this.h);this.e=this.v;this.m=this.s;this.j=this.t;break;default:throw Error("invalid inflate mode");
}}function d(a,b){for(var c=a.f,d=a.c,e=a.input,f=a.d,g=e.length;d<b;){if(f>=g)throw Error("input buffer is broken");c|=e[f++]<<d;d+=8}a.f=c>>>b;a.c=d-b;a.d=f;return c&(1<<b)-1}function e(a,b){for(var c=a.f,d=a.c,e=a.input,f=a.d,g=e.length,k=b[0],l=b[1];d<l&&!(f>=g);)c|=e[f++]<<d,d+=8;e=k[c&(1<<l)-1];g=e>>>16;a.f=c>>g;a.c=d-g;a.d=f;return e&65535}function f(a){function c(a,b,f){var g,k=this.p,l,n;for(n=0;n<a;)switch(g=e(this,b),g){case 16:for(l=3+d(this,2);l--;)f[n++]=k;break;case 17:for(l=3+d(this,
3);l--;)f[n++]=0;k=0;break;case 18:for(l=11+d(this,7);l--;)f[n++]=0;k=0;break;default:k=f[n++]=g}this.p=k;return f}var f=d(a,5)+257,g=d(a,5)+1,l=d(a,4)+4,n=new (k?Uint8Array:Array)(q.length),m;for(m=0;m<l;++m)n[q[m]]=d(a,3);if(!k)for(m=l,l=n.length;m<l;++m)n[q[m]]=0;l=b(n);n=new (k?Uint8Array:Array)(f);m=new (k?Uint8Array:Array)(g);a.p=0;a.j(b(c.call(a,f,l,n)),b(c.call(a,g,l,m)))}var g=this,k="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==
typeof DataView,l=0,n=1;c.prototype.u=function(){for(;!this.l;){var a=d(this,3);a&1&&(this.l=!0);a>>>=1;switch(a){case 0:var a=this.input,b=this.d,c=this.b,e=this.a,g=a.length,m=void 0,t=void 0,B=c.length,t=void 0;this.c=this.f=0;if(b+1>=g)throw Error("invalid uncompressed block header: LEN");m=a[b++]|a[b++]<<8;if(b+1>=g)throw Error("invalid uncompressed block header: NLEN");t=a[b++]|a[b++]<<8;if(m===~t)throw Error("invalid uncompressed block header: length verify");if(b+m>a.length)throw Error("input buffer is broken");
switch(this.i){case l:for(;e+m>c.length;){t=B-e;m-=t;if(k)c.set(a.subarray(b,b+t),e),e+=t,b+=t;else for(;t--;)c[e++]=a[b++];this.a=e;c=this.e();e=this.a}break;case n:for(;e+m>c.length;)c=this.e({o:2});break;default:throw Error("invalid inflate mode");}if(k)c.set(a.subarray(b,b+m),e),e+=m,b+=m;else for(;m--;)c[e++]=a[b++];this.d=b;this.a=e;this.b=c;break;case 1:this.j(C,D);break;case 2:f(this);break;default:throw Error("unknown BTYPE: "+a);}}return this.m()};var m=[16,17,18,0,8,7,9,6,10,5,11,4,12,
3,13,2,14,1,15],q=k?new Uint16Array(m):m,m=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=k?new Uint16Array(m):m,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],x=k?new Uint8Array(m):m,m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],z=k?new Uint16Array(m):m,m=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=k?new Uint8Array(m):m,m=new (k?Uint8Array:
Array)(288),p,s;p=0;for(s=m.length;p<s;++p)m[p]=143>=p?8:255>=p?9:279>=p?7:8;var C=b(m),m=new (k?Uint8Array:Array)(30);p=0;for(s=m.length;p<s;++p)m[p]=5;var D=b(m);c.prototype.j=function(a,b){var c=this.b,f=this.a;this.n=a;for(var g=c.length-258,k,l,m;256!==(k=e(this,a));)if(256>k)f>=g&&(this.a=f,c=this.e(),f=this.a),c[f++]=k;else for(k-=257,m=v[k],0<x[k]&&(m+=d(this,x[k])),k=e(this,b),l=z[k],0<y[k]&&(l+=d(this,y[k])),f>=g&&(this.a=f,c=this.e(),f=this.a);m--;)c[f]=c[f++-l];for(;8<=this.c;)this.c-=
8,this.d--;this.a=f};c.prototype.t=function(a,b){var c=this.b,f=this.a;this.n=a;for(var g=c.length,k,l,m;256!==(k=e(this,a));)if(256>k)f>=g&&(c=this.e(),g=c.length),c[f++]=k;else for(k-=257,m=v[k],0<x[k]&&(m+=d(this,x[k])),k=e(this,b),l=z[k],0<y[k]&&(l+=d(this,y[k])),f+m>g&&(c=this.e(),g=c.length);m--;)c[f]=c[f++-l];for(;8<=this.c;)this.c-=8,this.d--;this.a=f};c.prototype.e=function(){var a=new (k?Uint8Array:Array)(this.a-32768),b=this.a-32768,c,d,e=this.b;if(k)a.set(e.subarray(32768,a.length));else for(c=
0,d=a.length;c<d;++c)a[c]=e[c+32768];this.g.push(a);this.k+=a.length;if(k)e.set(e.subarray(b,b+32768));else for(c=0;32768>c;++c)e[c]=e[b+c];this.a=32768;return e};c.prototype.v=function(a){var b,c=this.input.length/this.d+1|0,d,e,f,g=this.input,l=this.b;a&&("number"===typeof a.o&&(c=a.o),"number"===typeof a.r&&(c+=a.r));2>c?(d=(g.length-this.d)/this.n[2],f=d/2*258|0,e=f<l.length?l.length+f:l.length<<1):e=l.length*c;k?(b=new Uint8Array(e),b.set(l)):b=l;return this.b=b};c.prototype.m=function(){var a=
0,b=this.b,c=this.g,d,e=new (k?Uint8Array:Array)(this.k+(this.a-32768)),f,g,l,m;if(0===c.length)return k?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(g=c.length;f<g;++f)for(d=c[f],l=0,m=d.length;l<m;++l)e[a++]=d[l];f=32768;for(g=this.a;f<g;++f)e[a++]=b[f];this.g=[];return this.buffer=e};c.prototype.s=function(){var a,b=this.a;k?this.q?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b);return this.buffer=a};a("Zlib.RawInflate",
c);a("Zlib.RawInflate.prototype.decompress",c.prototype.u);var m={ADAPTIVE:n,BLOCK:l},w,A;if(Object.keys)p=Object.keys(m);else for(w in p=[],s=0,m)p[s++]=w;s=0;for(A=p.length;s<A;++s)w=p[s],a("Zlib.RawInflate.BufferType."+w,m[w])}).call(this);
flax._flaxLoader={load:function(a,b,c,d){cc.loader.loadBinary(a,function(b,c){a=flax._removeResVersion(a);for(var g=(new Zlib.RawInflate(c)).decompress(),k="",l=g.length,n=0;n<l;n++)k+=String.fromCharCode(g[n]);c=k.split("data:image/gif;base64,");k=cc.path.changeBasename(a,".plist");g=cc.path.changeBasename(a,".png");cc.loader.cache[k]=JSON.parse(c[0]);k=new Image;k.src="data:image/gif;base64,"+c[1];cc.loader.cache[g]=k;cc.textureCache.handleLoadedTexture(g);flax.assetsManager.addAssets(a);b?d(b):
d(null,"Not reachable!");cc.loader.release(a);cc.loader.cache[a]="loaded!"})}};cc.sys.isNative||cc.loader.register(["flax"],flax._flaxLoader);flax._assetsClassMap={btn:"flax.SimpleButton",button:"flax.SimpleButton",progress:"flax.ProgressBar",jpg:"flax.Image",png:"flax.Image",scrollPane:"flax.ScrollPane",gun:"flax.Gunner",soundBtn:"flax.SimpleSoundButton"};flax._assetsMcClassMap={button:"flax.Button",scrollPane:"flax.MCScrollPane",gun:"flax.MCGunner",gun1:"flax.MCGunner",soundBtn:"flax.SoundButton"};flax.ASSET_NONE=0;flax.ASSET_ANIMATOR=1;flax.ASSET_MOVIE_CLIP=2;flax.ASSET_IMAGE=3;
flax.registerClass=function(a,b){flax._assetsClassMap[a]=b};flax.registerMcClass=function(a,b){flax._assetsMcClassMap[a]=b};
flax.AssetsManager=cc.Class.extend({framesCache:null,displaysCache:null,displayDefineCache:null,mcsCache:null,subAnimsCache:null,fontsCache:null,toolsVersion:null,init:function(){this.framesCache={};this.displaysCache={};this.displayDefineCache={};this.mcsCache={};this.subAnimsCache={};this.fontsCache={};this.toolsVersion={}},getAssetType:function(a,b){if(this.getMc(a,b))return flax.ASSET_MOVIE_CLIP;var c=this.getDisplayDefine(a,b);return c?"jpg"==c.type||"png"==c.type?flax.ASSET_IMAGE:"share"==c.type?
this.getAssetType(this._getSharedPlist(a,c),b):flax.ASSET_ANIMATOR:flax.ASSET_NONE},createDisplay:function(a,b,c,d,e){if(null==a||null==b)throw"Please give me assetsFile and assetID!";null==e&&c&&(e=c["class"]);if(c&&"string"===typeof c||e&&"string"!==typeof e)throw"Params error: maybe you are using the old api, please use the latest!";this.addAssets(a);var f=this.getSubAnims(a,b);f.length&&(b=b+"$"+f[0]);var g=this.getDisplayDefine(a,b);if(g&&"share"==g.type)return this.createDisplay(this._getSharedPlist(a,
g),b,c,d,e);f=null;if(e&&(f=flax.nameToObject(e),null==f))throw"The class: "+e+" doesn't exist!";if(null==f){var k=!1;null==g&&(g=this.getMc(a,b),k=!0);if(g){e=g.type;"null"==e&&"jpg"!=b&&"png"!=b&&(e=b);f=flax.nameToObject(e);if(null==f){e=k?flax._assetsMcClassMap[e]:flax._assetsClassMap[e];if("flax.Image"==e&&g.scale9&&(e="flax.Scale9Image",null==flax.Scale9Image))throw"Please add module of 'gui' into project.json if you want to use Scale9Image!";f=flax.nameToObject(e)}null==f&&(f=k?flax.MovieClip:
flax.Animator,e=k?"flax.MovieClip":"flax.Animator",k&&c&&!0===c.batch&&(f=flax.MovieClipBatch,e="flax.MovieClipBatch"))}else throw"There is no display with assetID: "+b+" in assets file: "+a+", or make sure the display is not a BLANK symbol!";}null==c&&(c={});g=null;k=c.parent;delete c.parent;!0===d?g=flax.ObjectPool.get(a,e,b).fetch(b,k,c):(g=f.create?f.create(a,b):new f(a,b),g.attr(c),k&&k.addChild(g),g.clsName=e);return g},cloneDisplay:function(a,b,c){if(!flax.isFlaxDisplay(a))throw"cloneDisplay only support flax type display!";
b=this.createDisplay(a.assetsFile,a.assetID,{parent:c?a.parent:null},b,a.clsName);c&&b.setPosition(a.getPosition());b.setScale(a.getScale());b.setRotation(a.rotation);b.zIndex=a.zIndex;return b},removeAssets:function(a){delete this.framesCache[a];delete this.displaysCache[a];delete this.displayDefineCache[a];delete this.mcsCache[a];delete this.subAnimsCache[a];delete this.fontsCache[a];var b=a;".flax"==cc.path.extname(a)&&(b=cc.path.changeBasename(b,".plist"));cc.spriteFrameCache.removeSpriteFramesFromFile(b);
cc.loader.release(b);cc.loader.release(cc.path.changeBasename(b,".png"))},removeAllAssets:function(){for(var a in this.framesCache)this.removeAssets(a)},addAssets:function(a){if("undefined"!==typeof this.framesCache[a])return!1;var b=a;".flax"==cc.path.extname(a)&&(b=cc.path.changeBasename(b,".plist"));var c=cc.loader.getRes(b);if(null==c)throw"Make sure you have pre-loaded the resource: "+a;var d=c.metadata.flaxVersion;this.toolsVersion[a]=d||0;if(!d||d<flax.minToolVersion)throw"The resource: "+
a+" was exported with the old version of Flax, please do it with current version!";d=c.metadata.fps;cc.spriteFrameCache.addSpriteFrames(b);cc.loader.cache[b]="loaded!";var b=[],e=c.frames,f;for(f in e)b.push(f);b.sort();this.framesCache[a]=b;c.displays&&this._parseDisplays(a,c.displays,d);c.mcs&&this._parseMovieClips(a,c.mcs,d);c.fonts&&this._parseFonts(a,c.fonts);return!0},_parseDisplays:function(a,b,c){var d=[],e=null,f;for(f in b)d.push(f),e=b[f],e.anchors&&(e.anchors=this._parseFrames(e.anchors)),
e.colliders&&(e.colliders=this._parseFrames(e.colliders)),e.scale9&&(e.scale9=flax._strToRect(e.scale9)),e.fps=c||cc.game.config.frameRate,this.displayDefineCache[a+f]=e,this._parseSubAnims(a,f);this.displaysCache[a]=d},_parseMovieClips:function(a,b,c){for(var d in b){var e=b[d];e.anchors&&(e.anchors=this._parseFrames(e.anchors));e.colliders&&(e.colliders=this._parseFrames(e.colliders));var f,g=e.children,k;for(k in g)f=g[k],f.frames=this._strToArray(f.frames);e.fps=c||cc.game.config.frameRate;this.mcsCache[a+
d]=e;this._parseSubAnims(a,d)}},_parseFonts:function(a,b){for(var c in b)this.fontsCache[a+c]=b[c]},_parseSubAnims:function(a,b){var c=b.split("$"),d=c[0],c=c[1];if(d&&c&&""!=d&&""!=c){var d=a+d,e=this.subAnimsCache[d];null==e&&(e=[],this.subAnimsCache[d]=e);e.push(c)}},_parseFrames:function(a){var b={},c;for(c in a)b[c]=this._strToArray(a[c]);return b},_strToArray:function(a){a=a.split("|");for(var b=-1,c=[];++b<a.length;){var d=a[b];"null"===d?c.push(null):""===d?c.push(c[b-1]):c.push(d)}return c},
_getSharedPlist:function(a,b){return a.slice(0,a.indexOf("/"))+"/"+b.url+".plist"},getFrameNames:function(a,b,c){this.addAssets(a);a=this.framesCache[a];if(null==a)return[];-1==b&&(b=0);-1==c&&(c=a.length-1);return a.slice(parseInt(b),parseInt(c)+1)},getFrameNamesOfDisplay:function(a,b){var c=this.getDisplayDefine(a,b);if(null==c)throw"There is no display named: "+b+" in assetsFile: "+a;return this.getFrameNames(a,c.start,c.end)},getDisplayDefine:function(a,b){this.addAssets(a);return this.displayDefineCache[a+
b]},getDisplayNames:function(a){this.addAssets(a);return this.displaysCache[a]||[]},getRandomDisplayName:function(a){a=this.getDisplayNames(a);var b=Math.floor(Math.random()*a.length);return a[b]},getMc:function(a,b){this.addAssets(a);return this.mcsCache[a+b]},getSubAnims:function(a,b){this.addAssets(a);return this.subAnimsCache[a+b]||[]},getFont:function(a,b){this.addAssets(a);return this.fontsCache[a+b]},getToolVersion:function(a){return this.toolsVersion[a]||0}});
flax.AssetsManager.create=function(){var a=new flax.AssetsManager;a.init();return a};flax.ColliderType={rect:"Rect",circle:"Circle",polygon:"Poly"};
flax.Collider=cc.Class.extend({name:null,owner:null,type:flax.ColliderType.rect,physicsBody:null,physicsFixture:null,physicsContact:null,_center:null,_width:0,_height:0,_rotation:0,_localRect:null,_polygons:null,ctor:function(a,b){a=a.split(",");this.type=a[0];this._center=cc.p(parseFloat(a[1]),parseFloat(a[2]));this._width=parseFloat(a[3]);this._height=parseFloat(a[4]);this._rotation=parseFloat(a[5]);if(6<a.length){this._polygons=[];for(var c=a[6].split("'"),d=0;d<c.length-1;d+=2){var e={x:parseFloat(c[d]),
y:parseFloat(c[d+1])};this._polygons.push(e)}}!1===b&&(this._center.x+=this._width/2,this._center.y+=this._height/2);this._localRect=cc.rect(this._center.x-this._width/2,this._center.y-this._height/2,this._width,this._height)},setOwner:function(a){this.owner=a;this.owner.retain()},createPhysics:function(a,b,c,d,e,f){if(this.physicsFixture)return this.physicsFixture;var g=this.physicsBody=this.owner.physicsBody;if(null==g)throw"Please CreatePhysics in its owner firstly!";var k=this.getSize(),l=this.getCenter(),
n=flax.getPosition(this.owner,!0),m=null;if(this.type==flax.ColliderType.circle)m=new Box2D.Collision.Shapes.b2CircleShape,m.SetRadius(0.5*k.width*flax.getScale(this.owner,!0).x/PTM_RATIO),n=cc.pSub(l,n),m.SetLocalPosition(cc.pMult(n,1/PTM_RATIO));else if(this.type==flax.ColliderType.rect||this.type==flax.ColliderType.polygon){if(this.type==flax.ColliderType.rect)for(this._polygons=[cc.p(-0.5*k.width,-0.5*k.height),cc.p(0.5*k.width,-0.5*k.height),cc.p(0.5*k.width,0.5*k.height),cc.p(-0.5*k.width,0.5*
k.height)],k=0;k<this._polygons.length;k++)l=this._polygons[k],l.x+=this._center.x,l.y+=this._center.y;for(var m=new Box2D.Collision.Shapes.b2PolygonShape,q=[],k=0;k<this._polygons.length;k++)l=cc.p(this._polygons[k]),l=this.owner.convertToWorldSpace(l),l.x-=n.x,l.y-=n.y,l.x/=PTM_RATIO,l.y/=PTM_RATIO,q.push(l);m.SetAsArray(q)}else throw"The physics type: "+this.type+" is not supported!";n=new Box2D.Dynamics.b2FixtureDef;n.shape=m;null==a&&(a=0);n.density=a;null==b&&(b=0.2);n.friction=b;null==c&&(c=
0);n.restitution=c;n.isSensor=d;null==e&&(e=1);null==f&&(f=65535);n.filter.categoryBits=e;n.filter.maskBits=f;this.physicsFixture=g.CreateFixture(n);this.physicsFixture.SetUserData(this);return this.physicsFixture},destroyPhysics:function(){this.physicsFixture&&(flax.removePhysicsFixture(this.physicsFixture),this.physicsBody=this.physicsFixture=null);this.owner&&(this.owner.release(),this.owner=null)},checkCollision:function(a){if(a.type==this.type&&this.type==flax.ColliderType.rect)return cc.rectIntersectsRect(this.getRect(!0),
a.getRect(!0));if(a.type==this.type&&this.type==flax.ColliderType.circle){var b=this.getCenter(!0),c=a.getCenter(!0);return cc.pDistance(b,c)<=(this.getSize().width+a.getSize().width)/2}if(this.type==flax.ColliderType.rect)return this._ifRectCollidCircle(this.getRect(!0),a.getRect(!0));if(this.type==flax.ColliderType.circle)return this._ifRectCollidCircle(a.getRect(!0),this.getRect(!0))},containPoint:function(a){return this.containsPoint(a)},containsPoint:function(a){a=this.owner.convertToNodeSpace(a);
return this.type==flax.ColliderType.rect?cc.rectContainsPoint(this._localRect,a):this.type==flax.ColliderType.polygon?this._polyContainsPoint(a):cc.pDistance(a,this._center)<=this._width/2},_polyContainsPoint:function(a){for(var b=!1,c=this._polygons.length,d=0,e=c-1;d<c;e=d++){var f=this._polygons[d],e=this._polygons[e];(intersect=f.y>a.y!==e.y>a.y&&a.x<(e.x-f.x)*(a.y-f.y)/(e.y-f.y)+f.x)&&(b=!b)}return b},_ifRectCollidCircle:function(a,b){var c=Math.abs(b.x+b.width/2-(a.x+a.width/2)),d=Math.abs(b.y+
b.height/2-(a.y+a.height/2));if(c>a.width/2+b.width/2||d>a.height/2+b.width/2)return!1;if(c<=a.width/2||d<=a.height/2)return!0;c-=a.width/2;d-=a.height/2;return c*c+d*d<=b.width/2*b.width/2},getRect:function(a){null==a&&(a=!0);if(!a)return this._localRect;var b=this.getCenter(a);a=this.getSize(a);return cc.rect(b.x-a.width/2,b.y-a.height/2,a.width,a.height)},getCenter:function(a){var b=this.owner.convertToWorldSpace(this._center);this.owner.parent&&(!1===a?b=this.owner.parent.convertToNodeSpace(b):
a instanceof cc.Node&&(b=a.convertToNodeSpace(b)));return b},getSize:function(a){var b=flax.getScale(this.owner,a);a=this._width*Math.abs(b.x);b=this._height*Math.abs(b.y);return{width:a,height:b}},debugDraw:function(){var a=this.getRect(!0);if(this.type==flax.ColliderType.rect)flax.drawRect(a);else{var b=cc.DrawNode.create();flax.currentScene&&flax.currentScene.addChild(b,99999);var c=cc.color(255,0,0,255),d=cc.color(0,255,0,122);if(this.type==flax.ColliderType.circle)b.drawCircle(this.getCenter(!0),
a.width/2,0,360,!1,1,c,d);else{for(var e=a=null,f=null,g=0;g<this._polygons.length-1;g++)e=cc.p(this._polygons[g]),e=this.owner.convertToWorldSpace(e),0==g&&(a=cc.p(e)),f=cc.p(this._polygons[g+1]),f=this.owner.convertToWorldSpace(f),b.drawSegment(e,f,1,c,d);b.drawSegment(f,a,1,c,d)}}}});flax.onCollideStart=new signals.Signal;flax.onCollideEnd=new signals.Signal;flax.onCollidePre=new signals.Signal;flax.onCollidePost=new signals.Signal;flax._physicsWorld=null;flax._physicsListener=null;
flax._physicsRunning=!1;flax._physicsBodyToRemove=null;flax._physicsFixtureToRemove=null;flax.physicsTypeStatic=0;flax.physicsTypeKinematic=1;flax.physicsTypeDynamic=2;flax.physicsWorldPos=cc.p();flax.createPhysicsWorld=function(a,b){flax._physicsWorld&&flax.destroyPhysicsWorld();var c=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(a.x,a.y),!0===b);c.SetContinuousPhysics(!0);flax.physicsWorldPos=cc.p();flax._physicsWorld=c;flax._physicsBodyToRemove=[];flax._physicsFixtureToRemove=[];return c};
flax.getPhysicsWorld=function(){if(null==flax._physicsWorld)throw"Pleas use flax.createPhysicsWorld to create the world firstly!";return flax._physicsWorld};flax.startPhysicsWorld=function(){flax.getPhysicsWorld()&&flax.currentScene&&!flax._physicsRunning&&(flax._createPhysicsListener(),flax.currentScene.schedule(flax._updatePhysicsWorld,1/cc.game.config.frameRate),flax._physicsRunning=!0)};
flax.stopPhysicsWorld=function(){flax._physicsRunning&&flax.currentScene&&(flax.currentScene.unschedule(flax._updatePhysicsWorld),flax._physicsRunning=!1)};
flax.destroyPhysicsWorld=function(){if(flax._physicsWorld){flax.stopPhysicsWorld();for(var a=flax._physicsWorld.GetBodyList();a;a=a.GetNext()){var b=a.GetUserData();b&&(b._physicsBody=null);flax._physicsWorld.DestroyBody(a)}flax.onCollideStart.removeAll();flax.onCollideEnd.removeAll();flax.onCollidePre.removeAll();flax.onCollidePost.removeAll();flax._physicsWorld=null;flax._physicsListener=null;flax._physicsBodyToRemove=null}};
flax.removePhysicsBody=function(a){-1==flax._physicsBodyToRemove.indexOf(a)&&flax._physicsBodyToRemove.push(a)};flax.removePhysicsFixture=function(a){-1==flax._physicsFixtureToRemove.indexOf(a)&&flax._physicsFixtureToRemove.push(a)};
flax.physicsRaycast=function(a,b,c,d){flax.getPhysicsWorld().RayCast(function(e,f,g,k){e=e.GetUserData();f=cc.pMult(f,PTM_RATIO);var l=cc.pSub(c,f);g=cc.pMult(g,cc.pDot(l,g));l=cc.pSub(c,cc.pMult(g,2));g=flax.getAngle(f,l);d&&0<d&&(k=flax.getAngle(b,c),d/=Math.sin(Math.abs(g/2-k/2)*Math.PI/180),f=cc.pSub(f,flax.getPointOnCircle(cc.p(),d,k)),l=cc.pDistance(b,c),k=cc.pDistance(b,f)/l,l=flax.getPointOnCircle(f,l*(1-k),g));a(e,f,l,k)},cc.pMult(b,1/PTM_RATIO),cc.pMult(c,1/PTM_RATIO))};
flax.physicsSimulate=function(a,b,c){c||(c=flax.frameInterval);b=Math.round(b/c);for(var d=a.GetPosition(),e=a.GetAngle(),f={},g=0,k=flax._physicsWorld.GetBodyList();k;k=k.GetNext())if(k!=a){var l=k.GetType();l!=flax.physicsTypeStatic&&(k.m_type=flax.physicsTypeStatic,k.__tempKey=++g,f[k.__tempKey]=l)}l=[];for(g=0;g<b;g++)flax._physicsWorld.Step(c,velocityIterations,positionIterations),k=a.GetPosition(),l.push(cc.p(k.x*PTM_RATIO,k.y*PTM_RATIO));for(k=flax._physicsWorld.GetBodyList();k;k=k.GetNext())k.__tempKey&&
(k.SetType(f[k.__tempKey]),delete k.__tempKey);a.SetPositionAndAngle(d,e);return l};
flax._createPhysicsListener=function(){flax._physicsListener||(flax._physicsListener=new Box2D.Dynamics.b2ContactListener,flax._physicsListener.BeginContact=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetUserData()||b,c=c.GetUserData()||c;b.owner&&null==b.owner.parent||c.owner&&null==c.owner.parent||(b.physicsContact=c.physicsContact=a,flax.onCollideStart.dispatch(b,c),b.physicsContact=c.physicsContact=null)},flax._physicsListener.EndContact=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),
b=b.GetUserData()||b,c=c.GetUserData()||c;b.owner&&null==b.owner.parent||c.owner&&null==c.owner.parent||(b.physicsContact=c.physicsContact=a,flax.onCollideEnd.dispatch(b,c),b.physicsContact=c.physicsContact=null)},flax._physicsListener.PreSolve=function(a,b){var c=a.GetFixtureA(),d=a.GetFixtureB(),c=c.GetUserData()||c,d=d.GetUserData()||d;c.owner&&null==c.owner.parent||d.owner&&null==d.owner.parent||(c.physicsContact=d.physicsContact=a,flax.onCollidePre.dispatch(c,d),c.physicsContact=d.physicsContact=
null)},flax._physicsListener.PostSolve=function(a,b){var c=a.GetFixtureA(),d=a.GetFixtureB(),c=c.GetUserData()||c,d=d.GetUserData()||d;c.owner&&null==c.owner.parent||d.owner&&null==d.owner.parent||(c.physicsContact=d.physicsContact=a,flax.onCollidePost.dispatch(c,d),c.physicsContact=d.physicsContact=null)},flax._physicsWorld.SetContactListener(flax._physicsListener))};
flax.createPhysicalWalls=function(a,b){if(null==a||0==a.length)a=[1,1,1,1];var c=flax.getPhysicsWorld(),d=new Box2D.Dynamics.b2FixtureDef;d.density=1;null==b&&(b=3);d.friction=b;var e=new Box2D.Dynamics.b2BodyDef,f=cc.director.getWinSize();e.type=Box2D.Dynamics.b2Body.b2_staticBody;d.shape=new Box2D.Collision.Shapes.b2PolygonShape;d.shape.SetAsBox(0.5*f.width/PTM_RATIO,0.5);a[0]&&(e.position.Set(0.5*f.width/PTM_RATIO,f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d));a[1]&&(e.position.Set(0.5*
f.width/PTM_RATIO,0),c.CreateBody(e).CreateFixture(d));d.shape.SetAsBox(0.5,0.5*f.height/PTM_RATIO);a[2]&&(e.position.Set(0,0.5*f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d));a[3]&&(e.position.Set(f.width/PTM_RATIO,0.5*f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d))};var velocityIterations=8,positionIterations=1;
flax._updatePhysicsWorld=function(a){for(var b=flax._physicsFixtureToRemove.length;b--;){var c=flax._physicsFixtureToRemove[b],d=c.GetBody();d&&d.DestroyFixture(c);flax._physicsFixtureToRemove.splice(b,1)}for(b=flax._physicsBodyToRemove.length;b--;)flax._physicsWorld.DestroyBody(flax._physicsBodyToRemove[b]),flax._physicsBodyToRemove.splice(b,1);flax._physicsWorld.Step(a,velocityIterations,positionIterations);for(a=flax._physicsWorld.GetBodyList();a;a=a.GetNext())b=a.GetUserData(),null!=b&&null!=
b&&b.parent&&(c=cc.p(a.GetPosition()),c.x*=PTM_RATIO,c.y*=PTM_RATIO,c=cc.pAdd(c,flax.physicsWorldPos),c=b.parent.convertToNodeSpace(c),b.x=c.x,b.y=c.y,!0!==b.ignoreBodyRotation&&(b.rotation=-1*RADIAN_TO_DEGREE*a.GetAngle(),b.rotation+=a.__rotationOffset))};flax._debugBox2DNode=null;flax.debugDrawPhysics=function(){null==flax._debugBox2DNode&&(flax._debugBox2DNode=new flax.DebugBox2DNode(flax.getPhysicsWorld()),flax.currentScene.addChild(flax._debugBox2DNode,Number.MAX_VALUE))};
flax.DebugBox2DNode=cc.Node.extend({_refWorld:null,ctor:function(a){this._super();this._refWorld=a;a=Box2D.Dynamics.b2DebugDraw;var b=new a;b.SetSprite(document.getElementById("gameCanvas").getContext("2d"));var c=PTM_RATIO*cc.view.getViewPortRect().width/cc.view.getDesignResolutionSize().width;b.SetDrawScale(c);b.SetFillAlpha(0.5);b.SetLineThickness(1);b.SetFlags(a.e_shapeBit|a.e_jointBit|a.e_centerOfMassBit);this._refWorld.SetDebugDraw(b)},draw:function(a){this._super();this._refWorld&&(a.scale(1,
-1),this._refWorld.DrawDebugData(),a.scale(1,1),a.translate(0,0))}});flax.TileMapModule={tx:0,ty:0,autoUpdateTileWhenMove:!0,tileValue:TileValue.WALKABLE,_tileMap:null,_tileInited:!1,onEnter:function(){this._tileMap&&!this._tileInited&&this.updateTile(!0)},onExit:function(){this._tileMap&&this._tileMap.removeObject(this);this._tileMap=null;this._tileInited=!1},onPosition:function(){this.autoUpdateTileWhenMove&&this._tileMap&&this.updateTile()},getTileMap:function(){return this._tileMap},setTileMap:function(a){!a||a instanceof flax.TileMap||(a=flax.getTileMap(a));this._tileMap!=
a&&(this._tileMap&&this._tileMap.removeObject(this),this._tileMap=a,null!=this._tileMap&&this.parent&&this.updateTile(!0))},updateTile:function(a){if(this._tileMap){var b=this.getPosition();this.parent&&(b=this.parent.convertToWorldSpace(b));b=this._tileMap.getTileIndex(b);this.setTile(b.x,b.y,a)}},setTile:function(a,b,c){if(!0===c||a!=this.tx||b!=this.ty){c=this.tx;var d=this.ty;this.tx=a;this.ty=b;this._tileMap&&this.parent&&(this._tileMap.removeObject(this,c,d),this.parent&&(this._tileMap.addObject(this),
this._tileInited=!0))}},snapToTile:function(a,b,c){this._tileMap.snapToTile(this,a,b,c)}};var HLayoutType={LEFT:0,CENTER:1,RIGHT:2},VLayoutType={BOTTOM:0,MIDDLE:1,TOP:2};
flax.getLayoutPosition=function(a,b,c){var d=flax.getRect(a,!0),e=cc.visibleRect.center,f=a.getAnchorPointInPoints(),g=0,k=0;switch(b){case HLayoutType.LEFT:g=0;break;case HLayoutType.CENTER:g=e.x-d.width/2;break;case HLayoutType.RIGHT:g=cc.visibleRect.right.x-d.width}switch(c){case VLayoutType.BOTTOM:k=0;break;case VLayoutType.MIDDLE:k=e.y-d.height/2;break;case VLayoutType.TOP:k=cc.visibleRect.top.y-d.height}d=flax.getScale(a,!0);b=cc.p(g+(b?0:cc.visibleRect.bottomLeft.x)+f.x*d.x,k+(c?0:cc.visibleRect.bottomLeft.y)+
f.y*d.y);a.parent&&(b=a.parent.convertToNodeSpace(b));return b};
flax.ScreenLayoutModule={_isAutoLayout:!1,_hlayout:null,_vlayout:null,_offsetX:0,_offsetY:0,onEnter:function(){flax.onDeviceRotate.add(this._updateLayout,this);flax.onScreenResize.add(this._updateLayout,this)},onExit:function(){flax.onDeviceRotate.remove(this._updateLayout,this);flax.onScreenResize.remove(this._updateLayout,this)},setLayoutOffset:function(a,b){this._offsetX=a;this._offsetY=b;this._updateLayout()},setLayout:function(a,b){this._isAutoLayout=!1;this._hlayout=a;this._vlayout=b;var c=
flax.getLayoutPosition(this,a,b);c.x+=this._offsetX;c.y+=this._offsetY;this.setPosition(c)},autoLayout:function(){if(cc.view.getResolutionPolicy()==cc.ResolutionPolicy.NO_BORDER){this._isAutoLayout=!0;var a=flax.getRect(this,this.parent),b=cc.visibleRect.center,c=this.getAnchorPointInPoints(),d=0,e=cc.visibleRect.width/flax.designedStageSize.width;if(1!=e){var f=this.x-b.x;0<f&&(d=a.width);f=a.x+d-b.x;this.x=b.x+f*e+c.x*this.scaleX-d+this._offsetX}e=cc.visibleRect.height/flax.designedStageSize.height;
1!=e&&(f=this.y-b.y,d=0,0<f&&(d=a.height),f=a.y+d-b.y,this.y=b.y+f*e+c.y*this.scaleY-d+this._offsetY)}},_updateLayout:function(a){this._isAutoLayout?this.autoLayout():null!=this._hlayout&&null!=this._vlayout&&this.setLayout(this._hlayout,this._vlayout)}};flax.MoveModule={gravityOnMove:null,destroyWhenReach:!1,destroyWhenOutofStage:!1,moveSpeed:null,moveAcc:null,restrainRect:null,inRandom:!1,_moveSpeedLen:0,_targetPos:null,_inMoving:!1,_callBack:null,_callContext:null,onEnter:function(){},onExit:function(){this.destroyWhenOutofStage=this.destroyWhenReach=!1;this.restrainRect=this.gravityOnMove=null;this._inMoving=this.inRandom=!1},moveTo:function(a,b,c,d){this.inRandom=!1;this._targetPos=a;this._callBack=c;this._callContext=d;a=cc.pSub(a,this.getPosition());
1>cc.pLength(a)||!b||0>=b?this.scheduleOnce(this._moveOver,0.01):(this.moveSpeed=cc.pMult(a,1/b),this._moveSpeedLen=cc.pLength(this.moveSpeed),this.resumeMove())},moveToBySpeed:function(a,b,c,d){this.inRandom=!1;this._targetPos=a;this._callBack=c;this._callContext=d;a=cc.pSub(a,this.getPosition());c=cc.pLength(a);1>c?this.scheduleOnce(this._moveOver,0.01):(this.moveSpeed=cc.pMult(a,b/c),this._moveSpeedLen=cc.pLength(this.moveSpeed),this.resumeMove())},moveBySpeed:function(a,b){this._callBack=this._targetPos=
null;this.inRandom=!1;this.moveSpeed="object"===typeof a?a:flax.getPointOnCircle(cc.p(),a,b);this.resumeMove()},moveRandomly:function(a,b,c){this.restrainRect=c||flax.stageRect;this.moveBySpeed(a,b||360*Math.random());this.inRandom=null==b},pauseMove:function(){this._inMoving&&(this.unschedule(this._doMove),this._inMoving=!1)},resumeMove:function(){this._inMoving||(this._inMoving=!0,this.schedule(this._doMove,flax.frameInterval,cc.REPEAT_FOREVER))},stopMove:function(){this._inMoving&&(this._targetPos=
this.moveSpeed=null,this._inMoving=!1,this.restrainRect=this._callBack=null,this.inRandom=!1,this.unschedule(this._doMove))},_doMove:function(a){var b=this.getPosition();if((this._targetPos?cc.pDistance(b,this._targetPos):Number.maxValue)<this._moveSpeedLen*a||this.destroyWhenOutofStage&&!cc.rectContainsRect(flax.stageRect,flax.getRect(this,!0)))this._moveOver(),this.stopMove();else{var c=flax.getRect(this,this.parent);if(this.restrainRect){var d=0,e=0;c.x<this.restrainRect.x?d=1:c.x>this.restrainRect.x+
this.restrainRect.width-c.width&&(d=-1);c.y<this.restrainRect.y?e=1:c.y>this.restrainRect.y+this.restrainRect.height-c.height&&(e=-1);this.inRandom&&(d&&(this.moveSpeed.x=d*Math.abs(this.moveSpeed.x)),e&&(this.moveSpeed.y=e*Math.abs(this.moveSpeed.y)))}c=this.moveAcc;this.gravityOnMove&&(c=cc.pAdd(c||cc.p(),this.gravityOnMove));c&&(this.moveSpeed=cc.pAdd(this.moveSpeed,cc.pMult(c,a)));this.setPosition(cc.pAdd(b,cc.pMult(this.moveSpeed,a)))}},_moveOver:function(){this._targetPos&&this.setPosition(this._targetPos);
this._callBack&&(this._callBack.apply(this._callContext||this),this._callBack=null);this.destroyWhenReach&&this.destroy()}};flax.Anchor=cc.Class.extend({x:0,y:0,zIndex:0,rotation:0,scaleX:1,scaleY:1,ctor:function(a){a=a.split(",");this.x=parseFloat(a[0]);this.y=parseFloat(a[1]);2<a.length&&(this.zIndex=parseInt(a[2]));3<a.length&&(this.rotation=parseFloat(a[3]));4<a.length&&(this.scaleX=parseFloat(a[4]));5<a.length&&(this.scaleY=parseFloat(a[5]));cc.log(this.scaleX+","+a.length)}});
flax._sprite={__instanceId:null,onAnimationOver:null,onSequenceOver:null,onFrameChanged:null,onFrameLabel:null,autoDestroyWhenOver:!1,autoStopWhenOver:!1,autoHideWhenOver:!1,autoRecycle:!1,currentFrame:0,currentAnim:null,totalFrames:0,frameInterval:0,ignoreBodyRotation:!1,define:null,name:null,assetsFile:null,assetID:null,clsName:"flax.FlaxSprite",playing:!1,_prevFrame:-1,_labelFrames:null,_labelSounds:null,_loopStart:0,_loopEnd:0,_isLanguageElement:!1,__isFlaxSprite:!0,__isInputMask:!1,_fps:24,_colliders:null,
_mainCollider:null,_physicsBody:null,_definedMainCollider:!1,_anchorBindings:null,_inited:!1,_mouseEnabled:!0,_baseAssetID:null,_subAnims:null,_animSequence:null,_loopSequence:!1,_sequenceIndex:0,_physicsToBeSet:null,_physicsBodyParam:null,_physicsColliders:null,_fpsForAnims:null,ctor:function(a,b){if("flax.FlaxSprite"==this.clsName)throw"flax.FlaxSprite is an abstract class, please use flax.Animator or flax.MovieClip!";this instanceof cc.SpriteBatchNode?cc.SpriteBatchNode.prototype.ctor.call(this,
cc.path.changeExtname(a,".png")):cc.Sprite.prototype.ctor.call(this);if(!a||!b)throw"Please set assetsFile and assetID to me!";this.__instanceId=ClassManager.getNewInstanceId();this._anchorBindings=[];this._animSequence=[];this._fpsForAnims={};this.onAnimationOver=new signals.Signal;this.onSequenceOver=new signals.Signal;this.onFrameChanged=new signals.Signal;this.onFrameLabel=new signals.Signal;this.setSource(a,b)},setSource:function(a,b){if(null==a||null==b)throw"assetsFile and assetID can not be null!";
if(this.assetsFile!=a||this.assetID!=b&&this._baseAssetID!=b){this.assetsFile=a;this.currentAnim=null;this.assetID=this._handleSumAnims(b);this.define=this.getDefine();var c=this.define.anchorX,d=this.define.anchorY;isNaN(c)||isNaN(d)||this.setAnchorPoint(c,d);0==this.fps&&(this.fps=this.define.fps);this.onNewSource();this.currentFrame=0;this._initFrameLabels();this.renderFrame(this.currentFrame,!0);this._initColliders();this.parent&&this._updateLaguage();null==this.__pool__id__&&(this.__pool__id__=
this.assetID);this.currentAnim&&this.onFrameLabel.dispatch(this.currentAnim)}},_handleSumAnims:function(a){a=a.split("$");this._baseAssetID=a[0];this._subAnims=flax.assetsManager.getSubAnims(this.assetsFile,this._baseAssetID);var b=a[1];null==b&&this._subAnims&&(b=this._subAnims[0]);a=this._baseAssetID;b&&(a=this._baseAssetID+"$"+b,this.currentAnim=b);return a},_initFrameLabels:function(){this._labelFrames=[];this._frameSounds={};var a=this.define.labels;if(a){for(var b in a){var c=a[b];-1<b.indexOf("@")?
(null==this.define.sounds&&(this.define.sounds={}),this.define.sounds[""+c.start]=DEFAULT_SOUNDS_FOLDER+b.slice(0,b.indexOf("@")),delete a[b]):this._labelFrames.push(c.start)}flax.copyProperties(this.define.sounds,this._frameSounds)}},setFpsForAnim:function(a,b){this._fpsForAnims[a]=b},addFrameSound:function(a,b){this._frameSounds[""+a]=b},removeFrameSound:function(a){delete this._frameSounds[""+a]},getLabels:function(a){return this.define.labels?this.define.labels[a]:null},hasLabel:function(a){return null!=
this.getLabels(a)},getMainCollider:function(){return this.getCollider("main")||this._mainCollider},getPhysicsBody:function(){return this._physicsBody},getCollider:function(a){var b=null;this._colliders&&(a=this._colliders[a],null!=a&&(b=a[this.currentFrame]));return b},createPhysics:function(a,b,c){null==a&&(a=Box2D.Dynamics.b2Body.b2_dynamicBody);this._physicsBodyParam={type:a,fixedRotation:b,bullet:c};if(!this.parent)return null;if(null==this._physicsBody){var d=new Box2D.Dynamics.b2BodyDef;d.type=
a;d.fixedRotation=b;d.bullet=c;d.userData=this;a=flax.getPosition(this,!0);d.position.Set(a.x/PTM_RATIO,a.y/PTM_RATIO);this._physicsBody=flax.getPhysicsWorld().CreateBody(d);this._physicsBody.__rotationOffset=this.rotation}return this._physicsBody},destroyPhysics:function(){this.removePhysicsShape()},addPhysicsShape:function(a,b,c,d,e,f,g){if(null==this._physicsBody)throw"Please createPhysics firstly!";var k=this.getCollider(a);if(null==k)return cc.log("There is no collider named: "+a),null;if(k.physicsFixture)return k.physicsFixture;
var l={density:b,friction:c,restitution:d,isSensor:e,catBits:f,maskBits:g};if(this.parent)return a=k.createPhysics(b,c,d,e,f,g),-1==this._physicsColliders.indexOf(k)&&this._physicsColliders.push(k),a;null==this._physicsToBeSet&&(this._physicsToBeSet={});null==this._physicsToBeSet[a]&&(this._physicsToBeSet[a]=l);return null},removePhysicsShape:function(a){for(var b=this._physicsColliders.length;b--;){var c=this._physicsColliders[b];if(null==a||c.name==a)c.destroyPhysics(),this._physicsColliders.splice(b,
1)}0==this._physicsColliders.length&&(flax.removePhysicsBody(this._physicsBody),this._physicsBody=null)},_initColliders:function(){this._mainCollider=null;this._colliders={};var a=this.define.colliders;if(a){var b=null,c;for(c in a){this._colliders[c]=[];for(var d=a[c],e=-1;++e<d.length;)if(null==d[e])this._colliders[c][e]=null;else if(b=this._colliders[c][e]=new flax.Collider(d[e]),b.name=c,b.setOwner(this),"main"==c||"base"==c)this._mainCollider=b}}this._definedMainCollider=null!=this._mainCollider;
this._definedMainCollider||(this._mainCollider=new flax.Collider("Rect,0,0,"+this.width+","+this.height+",0",!1),this._mainCollider.name="main",this._mainCollider.setOwner(this));this._physicsColliders=[]},getRect:function(a){return this.getMainCollider().getRect(a)},debugDraw:function(){this.getMainCollider().debugDraw()},getCenter:function(a){return this.getMainCollider().getCenter(a)},getAnchor:function(a){if(this.define.anchors){var b=this.define.anchors[a];if(null!=b)return b instanceof flax.Anchor||
(b=new flax.Anchor(b[this.currentFrame]),this.define.anchors[a]=b),b}return null},bindAnchor:function(a,b,c){if(!this.define.anchors)return cc.log(this.assetID+": there is no any anchor!"),!1;if(null==this.define.anchors[a])return cc.log(this.assetID+": there is no anchor named "+a),!1;if(null==b)throw"Node can't be null!";if(-1<this._anchorBindings.indexOf(b))return cc.log(this.assetID+": anchor has been bound, "+a),!1;!1!==c&&this._anchorBindings.push(b);b.__anchor__=a;this._updateAnchorNode(b,
this.getAnchor(a));b.parent!=this&&(b.removeFromParent(!1),this.addChild(b));return!0},unbindAnchor:function(a,b){for(var c=null,d=-1,e=this._anchorBindings.length;++d<e;)if(c=this._anchorBindings[d],c===a||c.__anchor__===a){this._anchorBindings.splice(d,1);delete c.__anchor__;b&&(c.destroy?c.destroy():c.removeFromParent());break}},getCurrentLabel:function(){var a=this.define.labels;if(!a)return null;for(var b in a){var c=a[b];if(this.currentFrame>=c.start&&this.currentFrame<=c.end)return b}return null},
nextFrame:function(){this.gotoAndStop(Math.min(++this.currentFrame,this.totalFrames-1))},prevFrame:function(){this.gotoAndStop(Math.max(--this.currentFrame,0))},play:function(){this._isLanguageElement||this.__isButton||(this._loopStart=0,this._loopEnd=this.totalFrames-1,this.updatePlaying(!0),this.currentAnim=null)},playSequence:function(a){if(null==a)return!1;a instanceof Array||(a=Array.prototype.slice.call(arguments));if(0==a.length)return!1;this._loopSequence=!1;this._sequenceIndex=0;var b=this.gotoAndPlay(a[0]);
this._animSequence=a;return b},playSequenceLoop:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));this.playSequence(a);this._loopSequence=!0},stopSequence:function(){this._loopSequence=!1;this._animSequence.length=0},_setSubAnim:function(a,b){if(!a||0==a.length)return!1;if(null==this._subAnims||-1==this._subAnims.indexOf(a))return this.__isButton||cc.log("There is no animation named: "+a),!1;this.setSource(this.assetsFile,this._baseAssetID+"$"+a);!1===b?this.gotoAndStop(0):
(this._fpsForAnims[a]&&this.setFPS(this._fpsForAnims[a]),this.gotoAndPlay(0));this.currentAnim=a;this._animTime=0;return!0},gotoAndPlay:function(a,b){if(this._isLanguageElement||this.__isButton)return!1;if("string"===typeof a){if(this.playing&&this.currentAnim==a&&!0!==b)return!0;var c=this.getLabels(a);if(null==c)return c=this._setSubAnim(a,!0),c||(cc.log("There is no animation named: "+a),this.play()),c;this._loopStart=c.start;this._loopEnd=c.end;this.currentFrame=this._loopStart;this.currentAnim=
a;this._fpsForAnims[a]&&this.setFPS(this._fpsForAnims[a])}else{if(!this.isValideFrame(a))return cc.log("The frame: "+a+" is out of range!"),!1;this._loopStart=0;this._loopEnd=this.totalFrames-1;this.currentFrame=a;this.currentAnim=null}this.renderFrame(this.currentFrame);this.updatePlaying(!0);this._animTime=0;return!0},stop:function(){this.updatePlaying(!1);this.currentAnim=null},gotoAndStop:function(a){if(isNaN(a)){var b=this.getLabels(a);if(null==b)return(b=this._setSubAnim(a,!1))||this.__isButton||
cc.log("There is no animation named: "+a),b;a=b.start}this.currentAnim=null;if(!this.isValideFrame(a))return cc.log("The frame: "+a+" is out of range!"),!1;this.updatePlaying(!1);this.currentFrame=a;this.renderFrame(a);return!0},setFPS:function(a){this._fps!=a&&(this._fps=a,this.updateSchedule())},getFPS:function(){return this._fps},updatePlaying:function(a){this.playing!=a&&(this.playing=a,this.updateSchedule())},updateSchedule:function(){this.playing?1<this.totalFrames&&this.schedule(this.onFrame,
1/this._fps):this.unschedule(this.onFrame)},_animTime:0,onFrame:function(a){if(this.visible){this.currentFrame++;this._animTime+=a;this.currentFrame>this._loopEnd&&(this.currentFrame=this._loopEnd,(this.autoDestroyWhenOver||this.autoStopWhenOver||this.autoHideWhenOver)&&this.updatePlaying(!1),this.onAnimationOver.getNumListeners()&&this.onAnimationOver.dispatch(this),this.autoDestroyWhenOver?this.destroy():this.autoHideWhenOver?this.visible=!1:this._animSequence.length?this._playNext():this.autoStopWhenOver||
(this.currentFrame=this._loopStart),this._animTime=0);if(this.currentFrame>this._loopEnd||this.currentFrame>this.totalFrames-1)this.currentFrame=this._loopStart;this.renderFrame(this.currentFrame)}},_playNext:function(){this._sequenceIndex++;if(this._sequenceIndex>=this._animSequence.length&&(this._loopSequence?this._sequenceIndex=0:(this.autoStopWhenOver||this.gotoAndPlay(this._animSequence[this._sequenceIndex-1],!0),this._animSequence=[]),this.onSequenceOver.getNumListeners()&&this.onSequenceOver.dispatch(this),
0!=this._sequenceIndex))return;var a=this._animSequence,b=a[this._sequenceIndex];if("number"===typeof b)if(this._loopSequence&&this._sequenceIndex==a.length-1?this._sequenceIndex=0:this._sequenceIndex++,a.length>this._sequenceIndex&&"string"===typeof a[this._sequenceIndex]){var c=b,b=a[this._sequenceIndex];this.scheduleOnce(function(){this.gotoAndPlay(b)},c-this._animTime);this.updatePlaying(!1)}else this._animSequence=[],this.currentFrame=this._loopStart;else this.gotoAndPlay(b)},isValideFrame:function(a){return 0<=
a&&a<this.totalFrames},renderFrame:function(a,b){if(this._prevFrame!=a||!0==b){this._prevFrame!=a&&(this._prevFrame=a);this._handleAnchorBindings();this._updateCollider();this.doRenderFrame(a);this.onFrameChanged.getNumListeners()&&this.onFrameChanged.dispatch(this.currentFrame);-1<this._labelFrames.indexOf(a)&&this.onFrameLabel.dispatch(this.getCurrentLabel(a));var c=this._frameSounds[""+a];c&&flax.playSound(c)}},doRenderFrame:function(a){},_handleAnchorBindings:function(){for(var a=null,b=null,
c=-1,d=this._anchorBindings.length;++c<d;)a=this._anchorBindings[c],a.visible&&(b=this.getAnchor(a.__anchor__),null!=b&&this._updateAnchorNode(a,b))},_updateAnchorNode:function(a,b){null!=b&&(a.x=b.x,a.y=b.y,a.zIndex=b.zIndex,a.rotation=b.rotation,a.setScaleX(b.scaleX),a.setScaleY(b.scaleY))},onEnter:function(){this._super();this._destroyed=!1;this._updateCollider();this._physicsBodyParam&&this.createPhysics(this._physicsBodyParam.type,this._physicsBodyParam.fixedRotation,this._physicsBodyParam.bullet);
if(this._physicsToBeSet)for(var a in this._physicsToBeSet){var b=this.getCollider(a),c=this._physicsToBeSet[a];b.createPhysics(c.density,c.friction,c.restitution,c.isSensor,c.catBits,c.maskBits);delete this._physicsToBeSet[a];-1==this._physicsColliders.indexOf(b)&&this._physicsColliders.push(b)}this._updateLaguage();flax.callModuleOnEnter(this);this.__fromPool&&(this.__fromPool=!1,this.release())},onExit:function(){this._super();this._destroyed=!0;this.onAnimationOver.removeAll();this.onSequenceOver.removeAll();
this.onFrameChanged.removeAll();this.onFrameLabel.removeAll();flax.inputManager&&(flax.inputManager.removeListener(this),this.__isInputMask&&flax.inputManager.removeMask(this));for(var a=null,b=-1,c=this._anchorBindings.length;++b<c;)a=this._anchorBindings[b],a.destroy?a.destroy():a.removeFromParent(!0),delete a.__anchor__;for(b=this._anchorBindings.length=0;b<this._physicsColliders.length;b++)this._physicsColliders[b].destroyPhysics();this._physicsColliders=[];this._physicsBody&&(flax.removePhysicsBody(this._physicsBody),
this._physicsBody=null);this._physicsBodyParam=null;flax.callModuleOnExit(this)},_updateLaguage:function(){(this._isLanguageElement=-1<flax.languageIndex&&this.name&&0==this.name.indexOf("label__"))&&(this.gotoAndStop(flax.languageIndex)||this.gotoAndStop(0))},_updateCollider:function(){},setPosition:function(a,b){var c=!1,c=this.getPositionX(),d=this.getPositionY();void 0===b?(c=a.x!=c||a.y!=d)&&this._super(a):(c=a!=c||b!=d)&&this._super(a,b);c&&this.parent&&(flax.callModuleFunction(this,"onPosition"),
this._updateCollider())},setPositionX:function(a){this.setPosition(a,this.getPositionY())},setPositionY:function(a){this.setPosition(this.getPositionX(),a)},_destroyed:!1,destroy:function(){this._destroyed||(this._destroyed=!0,this.autoRecycle&&flax.ObjectPool.get(this.assetsFile,this.clsName,this.__pool__id__||"").recycle(this),this.removeFromParent())},onRecycle:function(){this.autoRecycle=!1;this.setScale(1);this.opacity=255;this.rotation=0;this.ignoreBodyRotation=this.autoHideWhenOver=this.autoStopWhenOver=
this.autoDestroyWhenOver=!1;RESET_FRAME_ON_RECYCLE&&this.gotoAndStop(0);this.setPosition(0,0);this._animSequence.length=0;this._loopSequence=!1;this._sequenceIndex=0;this.currentAnim=null;this.__isInputMask=!1},isMouseEnabled:function(){return this._mouseEnabled},setMouseEnabled:function(a){this._mouseEnabled=a},getDefine:function(){return null},onNewSource:function(){}};flax.FlaxSprite=cc.Sprite.extend(flax._sprite);
flax.FlaxSprite.create=function(a,b){var c=new flax.FlaxSprite(a,b);c.clsName="flax.FlaxSprite";return c};flax.addModule(flax.FlaxSprite,flax.TileMapModule);flax.addModule(flax.FlaxSprite,flax.MoveModule);flax.addModule(flax.FlaxSprite,flax.ScreenLayoutModule);window.flax.FlaxSprite=flax.FlaxSprite;flax.FlaxSpriteBatch=cc.SpriteBatchNode.extend(flax._sprite);flax.FlaxSpriteBatch.create=function(a,b){var c=new flax.FlaxSpriteBatch(a,b);c.clsName="flax.FlaxSpriteBatch";return c};
flax.addModule(flax.FlaxSpriteBatch,flax.TileMapModule);flax.addModule(flax.FlaxSpriteBatch,flax.MoveModule);flax.addModule(flax.FlaxSpriteBatch,flax.ScreenLayoutModule);window.flax.FlaxSpriteBatch=flax.FlaxSpriteBatch;var _p=flax.FlaxSprite.prototype;cc.defineGetterSetter(_p,"mainCollider",_p.getMainCollider);cc.defineGetterSetter(_p,"physicsBody",_p.getPhysicsBody);cc.defineGetterSetter(_p,"center",_p.getCenter);cc.defineGetterSetter(_p,"fps",_p.getFPS,_p.setFPS);
cc.defineGetterSetter(_p,"tileMap",_p.getTileMap,_p.setTileMap);cc.defineGetterSetter(_p,"currentLabel",_p.getCurrentLabel);cc.defineGetterSetter(_p,"x",_p.getPositionX,_p.setPositionX);cc.defineGetterSetter(_p,"y",_p.getPositionY,_p.setPositionY);_p=flax.FlaxSpriteBatch.prototype;cc.defineGetterSetter(_p,"mainCollider",_p.getMainCollider);cc.defineGetterSetter(_p,"physicsBody",_p.getPhysicsBody);cc.defineGetterSetter(_p,"center",_p.getCenter);cc.defineGetterSetter(_p,"fps",_p.getFPS,_p.setFPS);
cc.defineGetterSetter(_p,"tileMap",_p.getTileMap,_p.setTileMap);cc.defineGetterSetter(_p,"currentLabel",_p.getCurrentLabel);cc.defineGetterSetter(_p,"x",_p.getPositionX,_p.setPositionX);cc.defineGetterSetter(_p,"y",_p.getPositionY,_p.setPositionY);flax.Animator=flax.FlaxSprite.extend({frameNames:null,clsName:"flax.Animator",onNewSource:function(){this.frameNames=flax.assetsManager.getFrameNames(this.assetsFile,this.define.start,this.define.end);this.totalFrames=this.frameNames.length;0==this.totalFrames&&cc.log("There is no frame for display: "+this.assetID)},doRenderFrame:function(a){this.setSpriteFrame(this.frameNames[a])},getDefine:function(){var a=flax.assetsManager.getDisplayDefine(this.assetsFile,this.assetID);if(null==a)throw"There is no Animator named: "+
this.assetID+" in assets: "+this.assetsFile+", or make sure this class extends from the proper class!";return a}});flax.Animator.create=function(a,b){var c=new flax.Animator(a,b);c.clsName="flax.Animator";return c};window.flax.Animator=flax.Animator;flax._image={define:null,name:null,assetsFile:null,assetID:null,clsName:"flax.Image",autoRecycle:!1,_anchorBindings:null,__instanceId:null,_imgFile:null,_sx:1,_sy:1,_imgSize:null,_destroyed:!1,ctor:function(a,b){this instanceof cc.Sprite?cc.Sprite.prototype.ctor.call(this):(this.define=flax.assetsManager.getDisplayDefine(a,b),this._imgFile=a.slice(0,a.lastIndexOf("/"))+"/"+this.define.url,cc.Scale9Sprite.prototype.ctor.call(this,this._imgFile,cc.rect(),this.define.scale9),this.clsName="flax.Scale9Image");
if(!a||!b)throw"Please set assetsFile and assetID to me!";this.__instanceId=ClassManager.getNewInstanceId();this._anchorBindings=[];this.setSource(a,b)},setSource:function(a,b){if(null==a||null==b)throw"assetsFile and assetID can not be null!";if(this.assetsFile!=a||this.assetID!=b){this.assetsFile=a;this.assetID=b;this.define=flax.assetsManager.getDisplayDefine(this.assetsFile,this.assetID);this._imgFile=this.assetsFile.slice(0,this.assetsFile.lastIndexOf("/"))+"/"+this.define.url;flax.Scale9Image&&
this instanceof flax.Scale9Image?this.initWithFile(this._imgFile,cc.rect(),this.define.scale9):this.initWithFile(this._imgFile);if(cc.sys.isNative)this.onImgLoaded();else this.addEventListener("load",this.onImgLoaded,this);var c=this.define.anchorX,d=this.define.anchorY;isNaN(c)||isNaN(d)||this.setAnchorPoint(c,d);this.onNewSource();null==this.__pool__id__&&(this.__pool__id__=this.assetID)}},onImgLoaded:function(){this._imgSize=(new cc.Sprite(this._imgFile)).getContentSize();this._updateSize(this._sx,
this._sy)},destroy:function(){this._destroyed||(this._destroyed=!0,this.autoRecycle&&flax.ObjectPool.get(this.assetsFile,this.clsName,this.__pool__id__||"").recycle(this),this.removeFromParent())},onEnter:function(){this._super();this._destroyed=!1},onExit:function(){this._super();flax.inputManager.removeListener(this);for(var a=null,b=-1,c=this._anchorBindings.length;++b<c;)a=this._anchorBindings[b],a.destroy?a.destroy():a.removeFromParent(!0),delete a.__anchor__;this._anchorBindings.length=0},onRecycle:function(){this.autoRecycle=
!1;this.setScale(1);this.opacity=255;this.rotation=0;this.setPosition(0,0)},getAnchor:function(a){return this.define.anchors&&(a=this.define.anchors[a],null!=a)?new flax.Anchor(a[0]):null},bindAnchor:function(a,b,c){if(!this.define.anchors)return cc.log(this.assetID+": there is no any anchor!"),!1;if(null==this.define.anchors[a])return cc.log(this.assetID+": there is no anchor named "+a),!1;if(null==b)throw"Node can't be null!";if(-1<this._anchorBindings.indexOf(b))return cc.log(this.assetID+": anchor has been bound, "+
a),!1;!1!==c&&this._anchorBindings.push(b);b.__anchor__=a;this._updateAnchorNode(b,this.getAnchor(a));b.parent!=this&&(b.removeFromParent(!1),this.addChild(b));return!0},_updateAnchorNode:function(a,b){null!=b&&(a.x=b.x,a.y=b.y,a.zIndex=b.zIndex,a.rotation=b.rotation)},setScaleX:function(a){flax.Scale9Image&&this instanceof flax.Scale9Image?(this._sx=a,this._updateSize(a,this._sy)):cc.Node.prototype.setScaleX.call(this,a)},setScaleY:function(a){flax.Scale9Image&&this instanceof flax.Scale9Image?(this._sy=
a,this._updateSize(this._sx,a)):cc.Node.prototype.setScaleY.call(this,a)},_updateSize:function(a,b){null!=this._imgSize&&(this.width=this._imgSize.width*a,this.height=this._imgSize.height*b)},onNewSource:function(){}};flax.Image=cc.Sprite.extend(flax._image);
cc.Scale9Sprite&&(flax.Scale9Image=cc.Scale9Sprite.extend(flax._image),_p=flax.Image.prototype,cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX),cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY),_p=flax.Scale9Image.prototype,cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX),cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY),window.flax.Image=flax.Image,window.flax.Scale9Image=flax.Scale9Image);
flax.Image.create=function(a,b){if(flax.assetsManager.getDisplayDefine(a,b).scale9){if(null==flax.Scale9Image)throw"Please add module of 'gui' into project.json if you want to use Scale9Image!";var c=new flax.Scale9Image(a,b)}else c=new flax.Image(a,b);return c};flax.FrameData=cc.Class.extend({x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:255,zIndex:-1,skewX:0,skewY:0,font:null,fontSize:12,fontColor:"",textAlign:"",textWidth:40,textHeight:20,_isText:!1,_data:null,_hasSkew:!1,ctor:function(a){this._data=a;this.x=parseFloat(a[0]);this.y=parseFloat(a[1]);this.rotation=parseFloat(a[2]);this.scaleX=parseFloat(a[3]);this.scaleY=parseFloat(a[4]);this.opacity=Math.round(255*parseFloat(a[5]));6<a.length&&(this.zIndex=parseInt(a[6]));7<a.length&&(this.skewX=parseFloat(a[7]));
8<a.length&&(this.skewY=parseFloat(a[8]));this._hasSkew=7<a.length;9<a.length&&(this._isText=!0,this.font=a[9],this.fontSize=parseInt(a[10]),this.fontColor=cc.hexToColor(a[11]),this.textAlign=H_ALIGHS.indexOf(a[12]),this.textWidth=parseFloat(a[13]),this.textHeight=parseFloat(a[14]))},setForChild:function(a){this._hasSkew||a.setRotation(this.rotation);a.setScaleX(this.scaleX);a.setScaleY(this.scaleY);this._hasSkew&&(a.setRotationX(this.skewX),a.setRotationY(this.skewY));a.setOpacity&&a.setOpacity(this.opacity);
var b=this.x,c=this.y;this.font&&a instanceof cc.LabelTTF&&(a.setFontName(this.font),a.setFontFillColor(this.fontColor),a.setHorizontalAlignment(this.textAlign),a.setDimensions({width:this.textWidth,height:this.textHeight}),a.setFontSize(this.fontSize-1),a.setFontSize(this.fontSize),b+=this.textWidth/2,c-=this.textHeight/2);a.setPositionX(b);a.setPositionY(c)},clone:function(){return new flax.FrameData(this._data)}});
flax._movieClip={clsName:"flax.MovieClip",sameFpsForChildren:!0,createChildFromPool:!0,_autoPlayChildren:!1,namedChildren:null,_theRect:null,_frameDatas:null,__isMovieClip:!0,replaceChild:function(a,b,c){var d=this.define.children[a];if(null==d)cc.log("There is no child with named: "+a+"  in MovieClip: "+this.assetID);else{var e=this.namedChildren[a];if(e){c||(c=this.assetsFile);d=flax.assetsManager.getAssetType(c,b);if(!d)throw"There is no display with assetID: "+b+" in assets: "+c;flax.assetsManager.getAssetType(e.assetsFile,
e.assetID)==d?e.setSource(c,b):(d=e._autoPlayChildren,e.destroy(),e=flax.assetsManager.createDisplay(c,b,null,this.createChildFromPool),e.name=a,this.namedChildren[a]=e,!0!==e.__isMovieClip||d||(e.autoPlayChildren=this._autoPlayChildren),this._autoPlayChildren&&!0===e.__isFlaxSprite&&(this.playing?e.gotoAndPlay(0):e.gotoAndStop(0)),this[a]=e,this.addChild(e))}else d["class"]=b,d.assetsFile=c}},getFrameData:function(a,b){return null==this._frameDatas[a]?null:this._frameDatas[a][b]},setOpacity:function(a){cc.Node.prototype.setOpacity.call(this,
a);for(var b in this.namedChildren){var c=this.namedChildren[b];c.setOpacity&&c.setOpacity(a)}},setColor:function(a){cc.Node.prototype.setColor.call(this,a);for(var b in this.namedChildren){var c=this.namedChildren[b];c.setColor&&c.setColor(a)}},onNewSource:function(){for(var a in this.namedChildren)this.namedChildren[a].destroy(),delete this.namedChildren[a],delete this[a];this.namedChildren={};this.totalFrames=this.define.totalFrames;this._theRect=flax._strToRect(this.define.rect);this.setContentSize(this._theRect.width,
this._theRect.height);this._initFrameDatas()},_initFrameDatas:function(){this._frameDatas={};for(var a in this.define.children){for(var b=[],c=this.define.children[a].frames,d=-1;++d<c.length;){var e=c[d];e&&(e=e.split(","),b[d]=new flax.FrameData(e))}this._frameDatas[a]=b}},onEnter:function(){this._super();this.setContentSize(this._theRect.width,this._theRect.height)},doRenderFrame:function(a){var b,c,d,e;for(e in this.define.children)c=this.define.children[e],d=this._frameDatas[e][a],b=this.namedChildren[e],
d?(null==b&&(b=null!=c.text?flax.Label.create(this.assetsFile,d,c):flax.assetsManager.createDisplay(c.assetsFile||this.assetsFile,c["class"],null,this.createChildFromPool),b.name=e,this.namedChildren[e]=b,this[e]=b,this.onNewChild(b)),d.setForChild(b),this.sameFpsForChildren&&(b.fps=this.fps),c=-1==d.zIndex?c.zIndex:d.zIndex,b.parent!=this?(b.removeFromParent(!1),this.addChild(b,c)):b.zIndex!=c&&(b.zIndex=c)):b&&(b.destroy?b.destroy():b.removeFromParent(!0),delete this.namedChildren[e],delete this[e])},
stop:function(){this._super();if(this._autoPlayChildren)for(var a in this.namedChildren){var b=this.namedChildren[a];!0===b.__isFlaxSprite&&b.stop()}},play:function(){this._super();if(this._autoPlayChildren)for(var a in this.namedChildren){var b=this.namedChildren[a];!0===b.__isFlaxSprite&&b.play()}},getAutoPlayChildren:function(){return this._autoPlayChildren},setAutoPlayChildren:function(a){if(this._autoPlayChildren!=a){this._autoPlayChildren=a;for(var b in this.namedChildren){var c=this.namedChildren[b];
!0===c.__isMovieClip&&(c.setAutoPlayChildren(a),a?c.play():c.stop())}}},onNewChild:function(a){!0===a.__isMovieClip&&(a.autoPlayChildren=this._autoPlayChildren);this._autoPlayChildren&&!0===a.__isFlaxSprite&&(this.playing?a.gotoAndPlay(0):a.gotoAndStop(0))},getDefine:function(){var a=flax.assetsManager.getMc(this.assetsFile,this.assetID);if(null==a)throw"There is no MovieClip named: "+this.assetID+" in assets: "+this.assetsFile+", or make sure this class extends from the proper class!";return a},
getChild:function(a,b){void 0===b&&(b=!0);var c=this.namedChildren[a];if(c)return c;if(!b)return null;for(var d in this.namedChildren)if(c=this.namedChildren[d],c.getChild&&(c=c.getChild(a,b)))return c;return null},getChildByAssetID:function(a){var b=null,c;for(c in this.namedChildren)if(b=this.namedChildren[c],b.assetID==a)return b;return null},getLabelText:function(a,b){var c=this.getChild(a,void 0===b?!0:b);return c&&(c instanceof flax.Label||c instanceof cc.LabelTTF)?c.getString():null},setLabelText:function(a,
b,c){return(a=this.getChild(a,void 0===c?!0:c))&&(a instanceof flax.Label||a instanceof cc.LabelTTF)?(a.setString(b),a):null},setFPS:function(a){if(this._fps!=a&&(this._fps=a,this.updateSchedule(),this.sameFpsForChildren)){a=null;for(var b in this.namedChildren)a=this.namedChildren[b],a.fps=this._fps}},onRecycle:function(){this._super();this._autoPlayChildren=!1;if(RESET_FRAME_ON_RECYCLE)for(var a in this.namedChildren){var b=this.namedChildren[a];!0===b.__isFlaxSprite&&b.gotoAndStop(0)}}};
flax.MovieClip=flax.FlaxSprite.extend(flax._movieClip);flax.MovieClip.create=function(a,b){var c=new flax.MovieClip(a,b);c.clsName="flax.MovieClip";return c};_p=flax.MovieClip.prototype;cc.defineGetterSetter(_p,"autoPlayChildren",_p.getAutoPlayChildren,_p.setAutoPlayChildren);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);window.flax.MovieClip=flax.MovieClip;flax.MovieClipBatch=flax.FlaxSpriteBatch.extend(flax._movieClip);
flax.MovieClipBatch.create=function(a,b){var c=new flax.MovieClipBatch(a,b);c.clsName="flax.MovieClipBatch";return c};_p=flax.MovieClipBatch.prototype;cc.defineGetterSetter(_p,"autoPlayChildren",_p.getAutoPlayChildren,_p.setAutoPlayChildren);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);window.flax.MovieClipBatch=flax.MovieClipBatch;flax.ProgressBarType={HORIZONTAL:"horizontal",VERTICAL:"vertical",RADIAL:"radial"};
flax.ProgressBar=flax.Animator.extend({pBar:null,_type:flax.ProgressBarType.HORIZONTAL,_reversed:!1,_tween:null,onEnter:function(){this._super()},getPercentage:function(){return this.pBar?this.pBar.percentage:0},setPercentage:function(a){this.pBar&&(this.pBar.percentage=a)},getType:function(){return this._type},setType:function(a){this._type!=a&&(this._type=a,this._updatePBar())},getReversed:function(){return this._reversed},setReversed:function(a){this._reversed!=a&&(this._reversed=a,this._updatePBar(),
this.percentage+=0.1,this.percentage-=0.1)},tween:function(a,b,c){null!=this.pBar&&(this._tween&&(this.pBar.stopAction(this._tween),this._tween.release()),this._tween=cc.progressFromTo(c,a,b),this._tween.retain(),this.pBar.runAction(this._tween))},stopTween:function(){this._tween&&this.pBar&&(this.pBar.stopAction(this._tween),this._tween.release(),this._tween=null)},doRenderFrame:function(a){if(a=cc.spriteFrameCache.getSpriteFrame(this.frameNames[a]))a=new cc.Sprite(a),null==this.pBar?(this.width=
a.width,this.height=a.height,this.pBar=cc.ProgressTimer.create(a),this._updatePBar(),this.pBar.setAnchorPoint(this.getAnchorPoint()),this.pBar.setPosition(this.getAnchorPointInPoints()),this.addChild(this.pBar)):this.pBar.setSprite(a)},_updatePBar:function(){if(null!=this.pBar)if(this._type==flax.ProgressBarType.RADIAL)this.pBar.type=0,this.pBar.setReverseDirection(this._reversed),this.pBar.midPoint=cc.p(0.5,0.5);else{this.pBar.type=1;var a=this._type==flax.ProgressBarType.HORIZONTAL,b=cc.p(0,0),
c=cc.p(a?1:0,a?0:1);this._reversed&&(a?b.x=1:b.y=1);this.pBar.midPoint=b;this.pBar.barChangeRate=c}}});flax.ProgressBar.create=function(a,b){var c=new flax.ProgressBar(a,b);c.clsName="flax.ProgressBar";return c};window.flax.ProgressBar=flax.ProgressBar;_p=flax.ProgressBar.prototype;cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);cc.defineGetterSetter(_p,"reversed",_p.getReversed,_p.setReversed);flax.Label=cc.Sprite.extend({mlWidth:0,mlHeight:0,fontName:null,fontSize:20,frames:[],chars:[],assetsFile:null,name:null,params:null,_str:null,_gap:0,_spaceGap:10,_charCanvas:null,_fontDefine:null,getString:function(){return this._str},setString:function(a){a!==this._str&&(this._str=""+a,this._updateStr())},getSpaceGap:function(){return this._spaceGap},setSpaceGap:function(a){this._spaceGap!=a&&(this._spaceGap=a,this._str&&-1<this._str.indexOf(" ")&&this._updateStr())},getGap:function(){return this._gap},
setGap:function(a){a!=this._gap&&(this._gap=a,this._str&&this._updateStr())},setFontName:function(a){if(null!=a&&(null==this.fontName||this.fontName!=a)){this.fontName=a;this._fontDefine=flax.assetsManager.getFont(this.assetsFile,this.fontName);if(null==this._fontDefine)throw"Can't find the font named: "+this.fontName;this.frames=flax.assetsManager.getFrameNames(this.assetsFile,parseInt(this._fontDefine.start),parseInt(this._fontDefine.end));this.chars=this._fontDefine.chars;this.fontSize=parseInt(this._fontDefine.size)}},
tweenInt:function(a,b,c){this.setString(a);var d=flax.numberSign(b-a);if(0!=d){var e=Math.abs(b-a),f=Math.max(c/e,flax.frameInterval),e=Math.round(c/f),d=d*Math.round(Math.abs(b-a)/e);this.schedule(function(a){a=parseInt(this._str);var c=a+d;0<d&&c>b?c=b:0>d&&c<b&&(c=b);c!=a&&this.setString(c)},f,e+10)}},_updateStr:function(){if(null==this._charCanvas){var a=cc.path.changeBasename(this.assetsFile,".png");this._charCanvas=new cc.SpriteBatchNode(a,this._str.length);this.addChild(this._charCanvas)}this._charCanvas.removeAllChildren();
for(i=this.mlHeight=this.mlWidth=0;i<this._str.length;i++)if(a=this._str[i],"\n"!=a)if(" "==a)this.mlWidth+=this._spaceGap;else{for(var b=-1,c=0;c<this.chars.length;c++)if(this.chars[c]==a){b=c;break}-1==b?cc.log("Not found the char: "+a+" in the fonts: "+this.fontName):(sprite=new cc.Sprite(cc.spriteFrameCache.getSpriteFrame(this.frames[b])),sprite.anchorX=this._fontDefine.anchorX,sprite.anchorY=this._fontDefine.anchorY,a=sprite.getContentSize(),sprite.x=this.mlWidth,sprite.y=0,this.mlWidth+=a.width,
i!=this._str.length-1&&(this.mlWidth+=this._gap),this.mlHeight=a.height>this.mlHeight?a.height:this.mlHeight,this._charCanvas.addChild(sprite))}if(this.params)for(b=Math.max(this.mlWidth/this.params.textWidth,this.mlHeight/this.params.textHeight),a=0,1<b&&(c=1/b,this._charCanvas.scale=c,a=this.mlHeight*(1-1/b)*b,this.mlWidth*=c,this.mlHeight*=c),b=(this.params.textWidth-this.mlWidth)/2,i=this._charCanvas.childrenCount;i--;)charChild=this._charCanvas.children[i],"center"==H_ALIGHS[this.params.textAlign]?
charChild.x+=b:"right"==H_ALIGHS[this.params.textAlign]&&(charChild.x+=2*b),charChild.y-=a;this._charCanvas.setContentSize(this.mlWidth,this.mlHeight);this.setContentSize(this.mlWidth,this.mlHeight)},getRect:function(a){null==a&&(a=!0);var b=cc.rect(0.5*this.width/this._str.length,-this.params.textHeight,this.width,this.height+2);b.y+=(this.params.textHeight-this.height)/2-1;if(!a)return b;var c=b.width,d=b.height,b=cc.p(b.x,b.y),b=this.convertToWorldSpace(b);a instanceof cc.Node&&(b=a.convertToNodeSpace(b));
return cc.rect(b.x,b.y,c,d)},destroy:function(){this.removeFromParent()}});_p=flax.Label.prototype;cc.defineGetterSetter(_p,"gap",_p.getGap,_p.setGap);cc.defineGetterSetter(_p,"spaceGap",_p.getSpaceGap,_p.setSpaceGap);cc.defineGetterSetter(_p,"text",_p.getString,_p.setString);_p=cc.LabelTTF.prototype;cc.defineGetterSetter(_p,"text",_p.getString,_p.setString);
flax.Label.create=function(a,b,c){if(!1===b._isText)throw"The assetsFile: "+a+" was exported with old version of Flax tool, re-export it to fix the Text issue!";cc.sys.isNative||(c.text=c.text.split("\\").join(""));var d=null,e=c["class"],d=flax.assetsManager.getFont(a,e);if(!0==c.input){if(null==cc.EditBox)throw"If you want to use input text, please add module of 'editbox' into project.json!";d=flax.assetsManager.getFrameNamesOfDisplay(a,e);d=new cc.EditBox(cc.size(b.textWidth,b.textHeight),new cc.Scale9Sprite(d[0]),
d[1]?new cc.Scale9Sprite(d[1]):null,d[2]?new cc.Scale9Sprite(d[2]):null);d.setFontColor(b.fontColor);d.setFontName(b.font);d.setFontSize(b.fontSize);d.setPlaceHolder(c.text);d.setPlaceholderFontName(b.font);d.setPlaceholderFontSize(b.fontSize);b=flax.assetsManager.getDisplayDefine(a,e);d.setAnchorPoint(b.anchorX,b.anchorY)}else b.font&&null==d?(a=new cc.FontDefinition,a.fontName=b.font,a.fontSize=b.fontSize,a.textAlign=b.textAlign,a.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_CENTER,a.fillStyle=b.fontColor,
a.fontDimensions=!0,a.boundingWidth=b.textWidth,a.boundingHeight=b.textHeight,d="null"==e?new cc.LabelTTF(c.text,a):new cc.LabelTTF(flax.getLanguageStr(e)||c.text,a)):(d=new flax.Label,flax.assetsManager.addAssets(a),d.assetsFile=a,d.params=b,d.setFontName(e),d.setAnchorPoint(0,0),d.setString(c.text));return d};flax._fontResources=null;flax.registerFont=function(a,b){a&&b&&("string"==typeof b&&(b=[b]),null==flax._fontResources&&(flax._fontResources={}),flax._fontResources[a]=b)};var ButtonState={UP:"up",OVER:"over",DOWN:"down",SELECTED:"selected",SELECTED_OVER:"selected_over",SELECTED_DOWN:"selected_down",DISABLED:"disabled",LOCKED:"locked"};MOUSE_DOWN_SCALE=0.95;
flax._buttonDefine={clickSound:null,group:null,_playChildrenOnState:!1,_state:null,_initScaleX:1,_initScaleY:1,_inScaleDown:!1,_inDisabledGray:!0,__isButton:!0,onEnter:function(){this._super();this._initScaleX=this.scaleX;this._initScaleY=this.scaleY;flax.inputManager.addListener(this,this._onPress,InputType.press);flax.inputManager.addListener(this,this._onClick,InputType.click);flax.inputManager.addListener(this,this._onMove,InputType.move);if(!cc.sys.isMobile){var a=this,b=cc.EventListener.create({event:cc.EventListener.MOUSE,
onMouseMove:function(b){if(0!=b.getButton()){var d={target:a,currentTarget:a};a.isMouseEnabled()&&a._onMove(b,d)}}});cc.eventManager.addListener(b,this)}},onExit:function(){this.group&&(this.group.removeButton(this),this.group=null);cc.eventManager.removeListener(this);this._super()},onRecycle:function(){this._super();this._playChildrenOnState=!1;this._state=null;this._inScaleDown=!1;this.disabledCover&&(this.disabledCover.visible=!0);this._inDisabledGray=!0},setState:function(a){var b=this.isSelected();
this._state=a;this.gotoAndStop(this._state)||(a=this.isSelected()?ButtonState.SELECTED:ButtonState.UP,this.gotoAndStop(a)||(this.gotoAndStop(0),-1<this._state.indexOf("down")&&(this._inScaleDown=!0,this.setScale(this._initScaleX*MOUSE_DOWN_SCALE,this._initScaleY*MOUSE_DOWN_SCALE)),this._state==ButtonState.DISABLED&&(this._inDisabledGray=!0,this.disabledCover&&(this.disabledCover.visible=!0))));-1==this._state.indexOf("down")&&this._inScaleDown&&this.setScale(this._initScaleX,this._initScaleY);this._state!=
ButtonState.DISABLED&&this._inDisabledGray&&(this._inDisabledGray=!1,this.disabledCover&&(this.disabledCover.visible=!1));this._playOrPauseChildren();this.isSelected()&&!b&&this.group&&this.group.updateButtons(this);this.handleStateChange()},handleStateChange:function(){},getState:function(){return this._state},isSelected:function(){return this._state&&0==this._state.indexOf("selected")},setSelected:function(a){this.isSelected()!=a&&this.isSelectable()&&this.isMouseEnabled()&&!this.isLocked()&&this.setState(a?
ButtonState.SELECTED:ButtonState.UP)},isSelectable:function(){return this.hasLabel(ButtonState.SELECTED)},setMouseEnabled:function(a){this.setState(a?ButtonState.UP:ButtonState.DISABLED);return!0},isMouseEnabled:function(){return this._state!=ButtonState.DISABLED},setLocked:function(a){this.setState(a?ButtonState.LOCKED:ButtonState.UP)},isLocked:function(){return this._state==ButtonState.LOCKED},setPlayChildrenOnState:function(a){this._playChildrenOnState!=a&&(this._playChildrenOnState=a,this._playOrPauseChildren())},
getPlayChildrenOnState:function(){return this._playChildrenOnState},_onPress:function(a,b){if(this._state!=ButtonState.LOCKED&&this._state!=ButtonState.DISABLED){var c=this.clickSound||flax.buttonSound;c&&flax.playSound(c);this._toSetState(ButtonState.DOWN)}},_onClick:function(a,b){this._state!=ButtonState.LOCKED&&this._state!=ButtonState.DISABLED&&(this.isSelectable()?!this.isSelected()||this.group?this.setState(ButtonState.SELECTED):this.setState(ButtonState.UP):this.setState(ButtonState.UP))},
_onMove:function(a,b){this._state!=ButtonState.DISABLED&&this._state!=ButtonState.LOCKED&&(flax.ifTouched(this,a.getLocation())?this._toSetState(cc.sys.isMobile?ButtonState.DOWN:ButtonState.OVER):this._toSetState(ButtonState.UP))},_toSetState:function(a){this.isSelectable()&&this.isSelected()&&(a=a==ButtonState.UP?ButtonState.SELECTED:"selected_"+a);this.setState(a)},_playOrPauseChildren:function(){for(var a=this.childrenCount;a--;){var b=this.children[a];flax.isFlaxSprite(b)&&(this._playChildrenOnState?
(b.autoPlayChildren=!0,b.play()):(b.autoPlayChildren=!1,b.stop()))}}};flax.SimpleButton=flax.Animator.extend(flax._buttonDefine);flax.SimpleButton.create=function(a,b){var c=new flax.SimpleButton(a,b);c.clsName="flax.SimpleButton";c.setState(ButtonState.UP);return c};window.flax.SimpleButton=flax.SimpleButton;_p=flax.SimpleButton.prototype;cc.defineGetterSetter(_p,"state",_p.getState,_p.setState);cc.defineGetterSetter(_p,"playChildrenOnState",_p.getPlayChildrenOnState,_p.setPlayChildrenOnState);
cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);flax.Button=flax.MovieClip.extend(flax._buttonDefine);flax.Button.create=function(a,b){var c=new flax.Button(a,b);c.clsName="flax.Button";c.setState(ButtonState.UP);return c};window.flax.Button=flax.Button;_p=flax.Button.prototype;cc.defineGetterSetter(_p,"state",_p.getState,_p.setState);cc.defineGetterSetter(_p,"playChildrenOnState",_p.getPlayChildrenOnState,_p.setPlayChildrenOnState);
cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);
flax.ButtonGroup=cc.Class.extend({buttons:null,selectedButton:null,onSelected:null,ctor:function(){this.buttons=[];this.onSelected=new signals.Signal},addButton:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));for(var b=0;b<a.length;b++){var c=a[b],c=a[b];!flax.isButton(c)||-1<this.buttons.indexOf(c)||(this.buttons.push(c),c.group=this)}},removeButton:function(a){var b=this.buttons.indexOf(a);-1<b&&(this.buttons.splice(b,1),a.group=null);0==this.buttons.length&&(this.onSelected.removeAll(),
this.onSelected=null)},updateButtons:function(a){for(var b=0;b<this.buttons.length;b++){var c=this.buttons[b];c!=a&&c.isMouseEnabled()&&!c.isLocked()&&c.setState(ButtonState.UP)}this.selectedButton=a;b=flax.mousePos&&flax.ifTouched(a,flax.mousePos);this.onSelected.dispatch(a,b)}});flax._preloader={resources:null,_label:null,_logo:null,_inited:!1,initWithResources:function(a,b){this.init();"string"==typeof a&&(a=[a]);this.resources=a||[];this.cb=b},init:function(){if(!this._inited){this._inited=!0;var a=this,b=cc.director.getWinSize();if(this instanceof cc.Layer){var c=new cc.LayerColor(cc.color(0,0,0,100));this.addChild(c,0)}var d=cc.p(b.width/2,b.height/2),e=cc.game.config.loading;e&&flax.isImageFile(e)?cc.loader.load(e,function(){a._logo=new cc.Sprite(e);a._logo.setPosition(d);
a.addChild(a._logo,10);if(!cc.sys.isNative){var b=16*(1+a._logo.width/200);a.createLabel(cc.pSub(d,cc.p(0,a._logo.height/2+0.6*b)),b);a.logoClick()}}):a.createLabel(d)}},createLabel:function(a,b){var c=this._label=new cc.LabelTTF("Loading...","Arial",b||18);c.enableStroke(cc.color(51,51,51),2);c.setColor(cc.color(255,255,255));c.setPosition(a);this.addChild(c,10)},logoClick:function(){var a=this._logo,b=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(b,
d){return cc.rectContainsPoint(flax.getRect(a,!0),b.getLocation())?(flax.goHomeUrl(),!0):!1}});cc.eventManager.addListener(b,this._logo)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.resources&&this.schedule(this._startLoading,0.3)},_startLoading:function(){var a=this;a.unschedule(a._startLoading);cc.loader.load(a.resources,function(b,c,d){null!=a._label&&a._showProgress("Loading: ",c,d)},function(){a.cb&&a.cb()})},_showProgress:function(a,b,c){this._label&&(null!=c?this._label.setString(a+
(c+1)+"/"+b):this._label.setString(a+b+"%"))}};flax.Preloader=cc.Scene.extend(flax._preloader);flax.ResPreloader=cc.Layer.extend(flax._preloader);window.flax.Preloader=flax.Preloader;window.flax.ResPreloader=flax.ResPreloader;ALL_DIRECTONS="UP DOWN LEFT RIGHT LEFT_UP RIGHT_UP RIGHT_DOWN LEFT_DOWN".split(" ");ALL_DIRECTONS0="UP DOWN LEFT RIGHT LEFT_UP LEFT_DOWN".split(" ");ALL_DIRECTONS1="UP DOWN LEFT RIGHT RIGHT_UP RIGHT_DOWN".split(" ");EIGHT_DIRECTIONS_VALUE={UP:[0,1],DOWN:[0,-1],LEFT:[-1,0],RIGHT:[1,0],LEFT_UP:[-1,1],RIGHT_UP:[1,1],RIGHT_DOWN:[1,-1],LEFT_DOWN:[-1,-1]};MAX_IN_TILE=10;
flax.TileMap=cc.Node.extend({isHexagon:!1,autoLayout:!1,_allTilesIndex:null,_gridCanvas:null,_tileWidth:0,_tileHeight:0,_mapWidth:0,_mapHeight:0,_objectsMap:null,_objectsArr:null,_inUpdate:!1,_offset:null,ctor:function(){this._super();this.setAnchorPoint(0,0);this._offset=cc.p()},init:function(a,b,c,d,e){if(!a||!b)throw"Please set tileWdith and tileHeight!";this._tileWidth=a;this._tileHeight=b;c||(c=cc.visibleRect.width);d||(d=cc.visibleRect.height);e&&(c=Math.ceil(c/this._tileWidth),d=Math.ceil(d/
this._tileHeight));this.setMapSize(c,d)},update:function(a){for(a=this._objectsArr?this._objectsArr.length:0;a--;){var b=this._objectsArr[a];b.autoUpdateTileWhenMove&&b.updateTile()}},getTileSize:function(){return{width:this._tileWidth,height:this._tileHeight}},getMapSizePixel:function(){var a=cc.size(this._tileWidth*this._mapWidth,this._tileHeight*this._mapHeight);this.isHexagon&&(a.width+=0.5*this._tileWidth);return a},setMapSize:function(a,b){var c=[[],[]];if(this._mapWidth==a&&this._mapHeight==
b)return c;null==this._objectsArr&&(this._objectsArr=[]);null==this._objectsMap&&(this._objectsMap=[]);for(var d=this._mapWidth,e=this._mapHeight,f=-1,g=-1,k=Math.max(a,d),l=Math.max(b,e);++f<k;){null==this._objectsMap[f]&&(this._objectsMap[f]=[]);for(g=-1;++g<l;)f>=a||g>=b?(c[0]=c[0].concat(this._objectsMap[f][g]),this.removeObjects(f,g),delete this._objectsMap[f][g]):f<d&&g<e||(this._objectsMap[f][g]=[],c[1].push([f,g]));0==this._objectsMap[f].length&&delete this._objectsMap[f]}this._mapWidth=a;
this._mapHeight=b;this.setContentSize(this.getMapSizePixel());return c},getMapSize:function(){return{width:this._mapWidth,height:this._mapHeight}},showDebugGrid:function(){this.showGrid()},showGrid:function(a,b){this._gridCanvas?this._gridCanvas.clear():(this._gridCanvas=cc.DrawNode.create(),this.addChild(this._gridCanvas));a||(a=1);b||(b=cc.color(255,0,0,255));for(var c=0;c<=this._mapWidth;c++)this._gridCanvas.drawSegment(cc.p(c*this._tileWidth,0),cc.p(c*this._tileWidth,this._tileHeight*this._mapHeight),
a,b);for(c=0;c<=this._mapHeight;c++)this._gridCanvas.drawSegment(cc.p(0,c*this._tileHeight),cc.p(this._tileWidth*this._mapWidth,c*this._tileHeight),a,b)},hideGrid:function(){this._gridCanvas&&this._gridCanvas.clear()},showDebugTile:function(a,b,c){a=this.getTiledPosition(a,b);null==c&&(c=cc.color(0,255,0,128));b=flax.getScale(this,!0);flax.drawRect(cc.rect(a.x-this._tileWidth*b.x/2,a.y-this._tileHeight*b.y/2,this._tileWidth*b.x,this._tileHeight*b.y),1,c,c)},clear:function(a){if(0!=this._objectsArr.length){void 0===
a&&(a=!0);for(var b,c=0;c<this._mapWidth;c++)for(var d=0;d<this._mapHeight;d++){if(a){b=this._objectsMap[c][d];for(var e in b){var f=b[e];f instanceof cc.Node&&f.destroy()}}this._objectsMap[c][d]=[]}this._objectsArr.length=0}},getTileIndex:function(a,b){var c,d;null==b?(c=a.x,d=a.y):(c=a,d=b);var e=this._offset;e.x=this.getPositionX();e.y=this.getPositionY();this.parent&&(e=this.parent.convertToWorldSpace(e));var f=flax.getScale(this,!0),g=Math.abs(f.x),k=Math.abs(f.y),f=Math.floor((c-e.x)/(this._tileWidth*
g));d=Math.floor((d-e.y)/(this._tileHeight*k));this.isHexagon&&0!=d%2&&(f=Math.floor((c-e.x-this._tileWidth*g*0.5)/(this._tileWidth*g)));return{x:f,y:d}},getTiledPosition:function(a,b){var c=this._offset;c.x=this.getPositionX();c.y=this.getPositionY();this.parent&&(c=this.parent.convertToWorldSpace(c));var d=flax.getScale(this,!0),e=Math.abs(d.x),f=Math.abs(d.y),d=(a+0.5)*this._tileWidth*e+c.x,c=(b+0.5)*this._tileHeight*f+c.y;this.isHexagon&&0!=b%2&&(d+=0.5*this._tileWidth*e);return{x:d,y:c}},getCoveredTiles:function(a,
b){var c=flax.getRect(a,!0);return this.getCoveredTiles1(c,b)},getCoveredTiles1:function(a,b){b=!0===b;for(var c=this.getTileIndex(a.x,a.y),d=c.x,e=c.y,c=this.getTileIndex(a.x+a.width,a.y+a.height),f=c.x,c=c.y,g=[],d=d-1,k=0;++d<=f;)for(k=e-1;++k<=c;)b?g=g.concat(this.getObjects(d,k)):g.push({x:d,y:k});return g},isValideTile:function(a,b){return 0<=a&&a<this._mapWidth&&0<=b&&b<this._mapHeight},snapToTile:function(a,b,c,d){if(a instanceof cc.Node){var e=null;if(null==b||null==c)e=a.getPosition(),a.parent&&
(e=a.parent.convertToWorldSpace(e)),c=this.getTileIndex(e),b=c.x,c=c.y;e=this.getTiledPosition(b,c);a.parent&&(e=a.parent.convertToNodeSpace(e));a.setPosition(e);!0===d&&a.setTileMap(this)}},snapAll:function(){for(var a=this._objectsArr.length,b=-1,c=null;++b<a;)c=this._objectsArr[b],this.snapToTile(c)},addObject:function(a,b,c){void 0===b&&(b=a.tx);void 0===c&&(c=a.ty);a.tx=b;a.ty=c;if(this.isValideTile(b,c)&&!(-1<this._objectsArr.indexOf(a))){this._objectsArr.push(a);var d=this._objectsMap[b][c];
!this._inUpdate&&cc.sys.isNative&&(this._inUpdate=!0,cc.director.getScheduler().scheduleUpdateForTarget(this));if(a instanceof cc.Node&&this.autoLayout){b=(b+(this._mapHeight-1-c)*this._mapWidth)*MAX_IN_TILE;c=null;for(var e=0,f=!1,g=0;g<d.length;g++)c=d[g],c instanceof cc.Node&&(!f&&c.y<=a.y&&(d.splice(g,0,a),a.zIndex=Math.min(e,MAX_IN_TILE)+b,f=!0,e++,g++),c.zIndex=Math.min(e,MAX_IN_TILE)+b,e++);f||(d.push(a),a.zOrder=Math.min(e,MAX_IN_TILE)+b)}else d.push(a)}},updateLayout:function(a,b){if(this.isValideTile(a,
b)){var c=this._objectsMap[a][b];if(0!=c.length){c.sort(this._sortByY);for(var d=(a+(this._mapHeight-1-b)*this._mapWidth)*MAX_IN_TILE,e=null,f=0,g=0;g<c.length;g++)e=c[g],e instanceof cc.Node&&(e.zIndex=Math.min(f,MAX_IN_TILE)+d,f++)}}},removeObject:function(a,b,c){void 0===b&&(b=a.tx);void 0===c&&(c=a.ty);this.isValideTile(b,c)&&(b=this._objectsMap[b][c],c=b.indexOf(a),-1<c&&b.splice(c,1),c=this._objectsArr.indexOf(a),-1<c&&this._objectsArr.splice(c,1));this._inUpdate&&cc.sys.isNative&&0==this._objectsArr.length&&
(this._inUpdate=!1,cc.director.getScheduler().unscheduleUpdateForTarget(this))},removeObjects:function(a,b){if(this.isValideTile(a,b))for(var c=this._objectsMap[a][b],d=null,d=-1;c.length;)d=c[0],d.tx=d.ty=-1,d=this._objectsArr.indexOf(d),-1<d&&this._objectsArr.splice(d,1),c.splice(0,1)},getObjects:function(a,b){return this.isValideTile(a,b)?this._objectsMap[a][b]:[]},getObjects1:function(a,b){var c=this.getTileIndex(a,b);return this.getObjects(c.x,c.y)},getAllObjects:function(){return this._objectsArr},
getTiles:function(a){for(var b=[],c=-1,d=-1;++c<this._mapWidth;)for(d=-1;++d<this._mapHeight;)null!=a&&!1===a(this,c,d)||b.push({x:c,y:d});return b},getRow:function(a,b){for(var c=-1,d=[];++c<this._mapHeight;)d=!0===b?d.concat(this.getObjects(a,c)):d.push({x:a,y:c});return d},getCol:function(a,b){for(var c=-1,d=[];++c<this._mapWidth;)d=!0===b?d.concat(this.getObjects(c,a)):d.push({x:c,y:a});return d},__tilesSearched:null,__nonRecursive:!1,findConnectedObjects:function(a,b,c){this.__tilesSearched=
{};b=this.findNeighbors(a,b,c,null,!1);a=b.indexOf(a);-1<a&&b.splice(a,1);this.__tilesSearched=null;return b},findNeighbors:function(a,b,c,d,e){for(var f=this._getAllDirections(a,c,d),g=!this.__nonRecursive&&null!=this.__tilesSearched,k=[],l=f.length;l--;){var n=EIGHT_DIRECTIONS_VALUE[f[l]],m=a.tx+n[0],n=a.ty+n[1];if(this.__tilesSearched){var q=m+"-"+n;if(!0===this.__tilesSearched[q])continue;this.__tilesSearched[q]=!0}if(e)k.push({x:m,y:n});else for(var m=this.getObjects(m,n),n=null,q=!1,v=0;v<m.length;v++)if(n=
m[v],null==b||0==b.length||n[b]===a[b])k.push(n),!q&&g&&(k=k.concat(this.findNeighbors(n,b,c,d,e)),q=!0)}return k},findSeparatedGroups:function(){var a=[],b=null;this.__tilesSearched={};var c=this.getAllObjects(),d=[],e=c.length;for(i=0;i<e;i++)nb=c[i],-1<d.indexOf(nb)||(b=this.findNeighbors(nb),b.length||!0===this.__tilesSearched[nb.tx+"-"+nb.ty]||(b=[nb],this.__tilesSearched[nb.tx+"-"+nb.ty]=!0),a.push(b),d=d.concat(b));this.__tilesSearched=null;return a},findSurroundings:function(a,b,c,d){if(null==
b||1>b)b=1;a=[a];var e=[];this.__tilesSearched={};for(this.__nonRecursive=!0;b--;){for(var f=[],g=0;g<a.length;g++){var k=a[g];void 0===k.tx&&(k={tx:k.x,ty:k.y});f=f.concat(this.findNeighbors(k,null,!0,null,c&&d?!c:!0))}a=f;if(c&&!d){for(var l=[],g=0;g<f.length;g++)k=f[g],l=l.concat(this.getObjects(k.x,k.y));e.push(l)}else e.push(f)}this.__tilesSearched=null;this.__nonRecursive=!1;return e},_getAllDirections:function(a,b,c){var d=ALL_DIRECTONS;this.isHexagon?d=0==a.ty%2?ALL_DIRECTONS0:ALL_DIRECTONS1:
b||(d=d.slice(0,4));a=ALL_DIRECTONS.indexOf(c);if(-1==a||3<a)return d;b=[];var e=null;for(a=0;a<d.length;a++)e=d[a],-1<e.indexOf(c)&&b.push(e);this.isHexagon&&1==b.length&&b.push("UP","DOWN");return b},isEmptyTile:function(a,b){if(!this.isValideTile(a,b))return!1;var c=this.getObjects(a,b);return c?0==c.length:!1},tileToIndex:function(a,b){return b*this._mapWidth+a},indexToTile:function(a){var b=a%this._mapWidth;return{x:b,y:Math.floor((a-b)/this._mapWidth)}},getAllTilesIndex:function(){if(!this._allTilesIndex){this._allTilesIndex=
[];for(var a=0;a<this._mapWidth*this._mapHeight;a++)this._allTilesIndex.push(a)}return this._allTilesIndex},findEmptyTilesIndex:function(){for(var a=this.getAllTilesIndex().concat(),b=this._objectsArr,c=b.length,d=0;d<c&&a.length;d++)for(var e=this.getCoveredTiles(b[d]),f=e.length,g=0;g<f;g++){var k=e[g],k=a.indexOf(this.tileToIndex(k.x,k.y));-1<k&&a.splice(k,1)}return a},_sortByY:function(a,b){if(a.y>b.y)return-1;if(a.y<b.y)return 1}});flax.TileMap.create=function(a){return new flax.TileMap(a)};
_p=flax.TileMap.prototype;cc.defineGetterSetter(_p,"tileSize",_p.getTileSize);cc.defineGetterSetter(_p,"mapSize",_p.getMapSize);flax._tileMaps={};flax.getTileMap=function(a){if("undefined"!==typeof flax._tileMaps[a])return flax._tileMaps[a];cc.log("The tileMap: "+a+" hasn't been defined, pls use flax.registerTileMap to define it firstly!");return null};flax.registerTileMap=function(a){flax._tileMaps[a.id]=a};flax.userData={};flax.fetchUserData=function(a){a&&(flax.userData=a);a=null;try{(a=cc.sys.localStorage.getItem(cc.game.config.gameId))&&(a=JSON.parse(a))}catch(b){cc.log("Fetch UserData Error: "+b.name)}a&&flax.copyProperties(a,flax.userData);flax.userData||(flax.userData={})};flax.saveUserData=function(){flax.userData||(flax.userData={});try{cc.sys.localStorage.setItem(cc.game.config.gameId,JSON.stringify(flax.userData))}catch(a){cc.log("Save UserData Error: "+a.name)}};flax.ObjectPool=cc.Class.extend({maxCount:100,_clsName:null,_cls:null,_assetsFile:null,_pool:null,_extraID:"",init:function(a,b,c){if(this._assetsFile&&this._cls)return cc.log("The pool has been inited with cls: "+this._cls),!1;this._clsName=b;this._cls=flax.nameToObject(b);if(null==this._cls)return cc.log("There is no class named: "+b),!1;this._assetsFile=a;this._pool=[];void 0!==c&&(this.maxCount=c);return!0},fetch:function(a,b,c){if(null==a)return cc.log("Please give me a assetID to fetch a object!"),
null;var d=null;0<this._pool.length?(d=this._pool.shift(),d.__fromPool=!0,d.setSource(this._assetsFile,a)):d=this._cls.create?this._cls.create(this._assetsFile,a):new this._cls(this._assetsFile,a);d.__pool__id__=this._extraID;d.clsName=this._clsName;d._destroyed=!1;d.autoRecycle=!0;d.visible=!0;c?"undefined"===typeof c.zIndex&&(c.zIndex=0):c={zIndex:0};d.attr(c);b&&b.addChild(d);return d},recycle:function(a){a instanceof this._cls?this._pool.length<this.maxCount&&(a.onRecycle&&a.onRecycle(),a.retain&&
a.retain(),this._pool.push(a)):cc.log("The object to recycle is not the same type with this pool: "+this._clsName)},release:function(){for(var a=this._pool.length;a--;)this._pool[a].release&&this._pool[a].release();this._pool.length=0}});flax.ObjectPool.all={};flax.ObjectPool.create=function(a,b,c){var d=new flax.ObjectPool;return d.init(a,b,c)?d:null};
flax.ObjectPool.get=function(a,b,c){null==b&&(b="flax.Animator");null==c&&(c="");var d=a+b+c,e=flax.ObjectPool.all[d];null==e&&(e=flax.ObjectPool.create(a,b),e._extraID=c,flax.ObjectPool.all[d]=e);return e};flax.ObjectPool.release=function(){for(var a in flax.ObjectPool.all)flax.ObjectPool.all[a].release(),delete flax.ObjectPool.all[a]};flax.HealthModule={maxHealth:100,health:100,hurtable:!0,dead:!1,ownerBody:null,onEnter:function(){this.health=this.maxHealth;this.dead=!1},onExit:function(){},onHit:function(a){if(!this.hurtable)return!1;if(this.dead)return!0;this.health-=a.damage;return 0>=this.health?(this.dead=!0,this.health=0,this.onDie(),!0):!1},onDie:function(){this.ownerBody?this.ownerBody.destroy():this.destroy()}};flax.EnemyWaveModule={waveAssetJson:null,waves:null,onWaveBegin:null,onEnemyIn:null,onWaveOver:null,batchCanvas:null,currentWave:-1,totalWaves:0,wavePaused:!0,waveOver:!1,_waveDefine:null,_enemyCount:0,_firstRun:!0,onEnter:function(){this.totalWaves=this.waves.length;this.onWaveBegin=new signals.Signal;this.onEnemyIn=new signals.Signal;this.onWaveOver=new signals.Signal;this.wavePaused||this.nextWave()},onExit:function(){this.onWaveBegin.removeAll();this.onEnemyIn.removeAll();this.onWaveOver.removeAll()},
startWave:function(){this.wavePaused&&(this.wavePaused=!1,this._firstRun?this.nextWave():this._createWaveEnemy(),this._firstRun=!1)},stopWave:function(){this.wavePaused||(this.wavePaused=!0)},nextWave:function(){this.waveOver||this.wavePaused||(this._enemyCount=0,this.currentWave++,this._waveDefine=this.waves[this.currentWave],this._createWaveEnemy(),this.onWaveBegin.dispatch())},_createWaveEnemy:function(){if(!this.waveOver&&!this.wavePaused){var a=flax.getRandomInArray(this._waveDefine.types),a=
this._doCreateEnemy(a);this.onEnemyIn.dispatch(a);++this._enemyCount<this._waveDefine.count?(a=flax.randInt(parseInt(this._waveDefine.interval[0]),parseInt(this._waveDefine.interval[1])),this.scheduleOnce(function(){this._createWaveEnemy()},a)):this.currentWave==this.totalWaves-1?(this.waveOver=!0,this.onWaveOver.dispatch()):this.nextWave()}},_doCreateEnemy:function(a){this.waveAssetJson&&flax.assetsManager.createDisplay(this.waveAssetJson,a,{parent:this.batchCanvas,x:this.x,y:this.y},!0)}};flax._soundButton={onEnter:function(){this._super();this.setState(flax.getSoundEnabled()?ButtonState.UP:ButtonState.SELECTED)},_onClick:function(a,b){this._super(a,b);flax.setSoundEnabled(!this.isSelected())}};flax.SimpleSoundButton=flax.SimpleButton.extend(flax._soundButton);flax.SoundButton=flax.Button.extend(flax._soundButton);flax.GunParam=cc.Class.extend({bulletAssets:null,bulletID:null,targetMap:null,selfMap:null,damage:1,damageRadius:0,speed:600,interval:0.15,count:1,angleGap:5,angleOffset:0,waveInterval:0,countInWave:6,gravityX:0,gravityY:0,fireSound:null,fireEffectID:null,hitEffectID:null,alwaysLive:!1,bulletPlayOnce:!1,fps:0,isMissle:!1});flax.GunParam.create=function(a){var b=new flax.GunParam;0==a.speed&&(a.speed=0.001);flax.copyProperties(a,b);return b};
flax.Gun=cc.Node.extend({owner:null,param:null,aimTarget:null,_firing:!1,_targetMap:null,_canvas:null,start:function(){this._firing||(this._firing=!0,this._canvas=flax.BulletCanvas.fetch(this.param.bulletAssets),0>=this.param.waveInterval||1>this.param.countInWave?(this.schedule(this.shootOnce,this.param.interval),this.shootOnce()):this._waveFire())},end:function(){this._firing&&(this._firing=!1,this.unschedule(this.shootOnce),this.unschedule(this._createWave))},updateParam:function(a){null!=a&&(flax.copyProperties(a,
this.param),this.end(),this.start())},isFiring:function(){return this._firing},_waveFire:function(){this._firing&&(this._createWave(),this.schedule(this._createWave,this.param.interval*this.param.countInWave+this.param.waveInterval,cc.REPEAT_FOREVER))},shootOnce:function(){if(null!=this.parent){var a=this.parent.convertToWorldSpace(this.getPosition());if(this.aimTarget&&this.aimTarget.parent&&this.aimTarget.visible){var b=flax.getAngle(flax.getPosition(this,!0),this.aimTarget.center);this.owner.onAimingTarget(b);
this.rotation=b-this.param.angleOffset-this.parent.rotation}for(var a=this._canvas.convertToNodeSpace(a),b=flax.getRotation(this,!0),c=-1,d=0,e=0,f=flax.createDInts(this.param.count);++c<this.param.count;)e=f[c],d=b+e*this.param.angleGap,this._canvas.addBullet(d,a,this.param,this.owner);this._showFireEffect(a,d);this.param.fireSound&&flax.playSound(this.param.fireSound)}},_createWave:function(){1<this.param.countInWave?this.schedule(this.shootOnce,this.param.interval,this.param.countInWave-1):this.shootOnce()},
_showFireEffect:function(a,b){if(null!=this.param.fireEffectID&&""!=this.param.fireEffectID){var c=flax.assetsManager.createDisplay(this.param.bulletAssets,this.param.fireEffectID,{parent:this._canvas},!0);c.zIndex=999;c.autoDestroyWhenOver=!0;c.setPosition(a);c.setRotation(b);c.gotoAndPlay(0)}}});
flax.BulletCanvas=cc.SpriteBatchNode.extend({assetsFile:null,onBulletHit:null,onBulletOut:null,_bullets:null,onEnter:function(){this._super();this._bullets=[];this.onBulletHit=new signals.Signal;this.onBulletOut=new signals.Signal;this.scheduleUpdate()},onExit:function(){this._super();this.onBulletHit.removeAll();this.onBulletOut.removeAll()},addBullet:function(a,b,c,d){if(null==this.parent)cc.log("Please create a bullet canvas: flax.BulletCanvas.create('"+this.assetsFile+"', container, zIndex);");
else{c instanceof flax.GunParam||(c=flax.GunParam.create(c));var e=flax.assetsManager.createDisplay(c.bulletAssets,c.bulletID,{parent:this},!0);e.owner=d;e.param=c;d&&d.targets&&(e.targets=d.targets);c.targetMap&&(e.targetMap=flax.getTileMap(c.targetMap));c.fps&&(e.fps=c.fps);e.__physicalShooted=!1;if(e instanceof flax.MovieClip){e.__isMovieClip=!0;e.autoPlayChildren=!0;e.autoDestroyWhenOver=!0;d=e.children.length;for(var f;d--;)f=e.children[d],c.selfMap&&f.setTileMap(c.selfMap),f.__isBullet=!0,f.__canvas=
this,f.__body=e}else c.selfMap&&(e.setTileMap(c.selfMap),e.__isBullet=!0,e.__canvas=this,e.__body=e);e.play();e.autoStopWhenOver=c.bulletPlayOnce;e.setPosition(b);e.setRotation(a);b=c.damage;b instanceof Array&&(1==b.length?b=b[0]:2<=b.length&&(b=flax.randInt(b[0],b[1])));e.damage=b;a=DEGREE_TO_RADIAN*(90-(a+c.angleOffset));e.__vx=c.speed*Math.cos(a);e.__vy=c.speed*Math.sin(a);this._bullets.push(e);return e}},destroyBullet:function(a,b,c){void 0===b&&(b=this._bullets.indexOf(a));0>b||(!1!==c&&a.destroy(),
this._bullets.splice(b,1))},update:function(a){var b=this._bullets.length;if(0!=b)for(var c=null,d=null,d=null,e=!1,e=null;b--;){c=this._bullets[b];c.physicsBody?c.__physicalShooted||(c.physicsBody.SetLinearVelocity({x:c.__vx/PTM_RATIO,y:c.__vy/PTM_RATIO}),c.__physicalShooted=!0):(c.__vx+=c.param.gravityX*a,c.__vy+=c.param.gravityY*a,c.x+=c.__vx*a,c.y+=c.__vy*a,c.rotation=flax.getAngle1(c.__vx,c.__vy,!0)-c.param.angleOffset);var d=flax.getRect(c,!0),e=!1,f=!cc.rectIntersectsRect(flax.stageRect,d);
f||(d=this._checkHittedTarget(c,d,!1))&&d.length&&(e=flax.getPosition(c,!0),d=c.param.damageRadius,0<d&&(d=cc.rect(e.x-d/2,e.y-d/2,d,d),this._checkHittedTarget(c,d,!0)),e=!0);f?(this.onBulletOut.dispatch(c),this.destroyBullet(c,b)):e&&(this.onBulletHit.dispatch(c),c.param.alwaysLive||this.destroyBullet(c,b))}},_checkHittedTarget:function(a,b,c){var d=[],e=null;a.targets?e=a.targets:a.targetMap&&(e=a.targetMap.getCoveredTiles1(b,!0));if(!e||!e.length)return d;b=flax.getRotation(a,!0);for(var f=-1;++f<
e.length;)if((target=e[f])&&target.parent&&target.visible&&(!a.owner||!(target==a.owner||flax.isChildOf(a.owner,target)||!0===target.dead||null!=a.owner.camp&&target.camp==a.owner.camp)))if(a.__isMovieClip)for(var g=a.children,k=g.length;k--;){var l=g[k];b=flax.getRotation(l,!0);if(l.mainCollider.checkCollision(target.mainCollider)){flax.callModuleFunction(target,"onHit",a);!1!==target.hurtable&&this._showHitEffect(a,b,a.convertToWorldSpace(l.getPosition()));target.__isBullet&&(l=target.__canvas._bullets.indexOf(target),
-1<l&&target.__canvas._bullets.splice(l,1),target.__body.destroy());if(!c)return[target];d.push(target)}}else if(a.mainCollider.checkCollision(target.mainCollider)){flax.callModuleFunction(target,"onHit",a);!1!==target.hurtable&&this._showHitEffect(a,b,a.getPosition());target.__isBullet&&(l=target.__canvas._bullets.indexOf(target),-1<l&&target.__canvas._bullets.splice(l,1),target.__body.destroy());if(!c)return[target];d.push(target)}return d},_showHitEffect:function(a,b,c){if(null!=a.param.hitEffectID&&
""!=a.param.hitEffectID){var d=flax.assetsManager.createDisplay(a.param.bulletAssets,a.param.hitEffectID,{parent:this},!0);d.zIndex=999;d.autoDestroyWhenOver=!0;d.setPosition(c||a.getPosition());d.setRotation(b);d.gotoAndPlay(0)}}});flax.BulletCanvas.create=function(a,b,c){a=flax.BulletCanvas.fetch(a);a.parent!=b&&(a.removeFromParent(),b.addChild(a,c||999))};
flax.BulletCanvas.fetch=function(a){if(flax._bulletCanvases[a])return flax._bulletCanvases[a];var b=cc.path.changeBasename(a,".png"),b=new flax.BulletCanvas(b,100);b.assetsFile=a;return flax._bulletCanvases[a]=b};flax._bulletCanvases={};flax.BulletCanvas.release=function(){flax._bulletCanvases={}};flax.Gun.create=function(a){if(null==a)return cc.log("Please give me a param defiled like: flax.GunParam!"),null;a=flax.GunParam.create(a);var b=new flax.Gun;b.param=a;b.init();return b};flax._gunnerDefine={camp:null,_gunParam:null,targets:null,alwaysBind:!0,_guns:null,_autoShooting:!1,_waitingShoot:!1,_auto:!1,onEnter:function(){this._super();this._guns=[];this._gunParam&&this.setGunParam(this._gunParam)},onRecycle:function(){this._super();this._guns=this.targets=this._gunParam=this.camp=null;this._autoShooting=this._waitingShoot=this._auto=!1;this.stopShoot()},getGunParam:function(){return this._gunParam},setGunParam:function(a,b){this._gunParam=a;if(null!=this.parent)if(b||(b=
a.gunAnchors),null==b)cc.log("Please set the gunAnchors param!");else{for(var c=-1,d=b.length,e=null,f=null;++c<d;)e=b[c],f=flax.Gun.create(this._gunParam),this.bindAnchor(e,f,this.alwaysBind)&&(f.owner=this,f.name=e,this[e]=f,this._guns.push(f));this._waitingShoot&&this.scheduleOnce(this.autoShoot,0.1)}},shoot:function(){this._auto=!1;this._doBeginShoot()},autoShoot:function(a){this._auto=!0;null==this.parent||null==this._guns||0==this._guns.length?this._waitingShoot=!0:(0<a?this.scheduleOnce(this._doBeginShoot,
a):this._doBeginShoot(),this._autoShooting=!0,this._waitingShoot=!1)},aimToTarget:function(a){if(a&&a.parent&&a.visible){null==this.targets?this.targets=[a]:-1==this.targets.indexOf(a)&&this.targets.push(a);for(var b=-1,c=this._guns.length,d=null;++b<c;)d=this._guns[b],d.aimTarget=a}},onAimingTarget:function(a){},_doBeginShoot:function(){for(var a=-1,b=this._guns.length;++a<b;)this._auto?this._guns[a].start():this._guns[a].shootOnce()},stopShoot:function(){this._autoShooting=!1;if(null!=this._guns&&
0!=this._guns.length)for(var a=-1,b=this._guns.length;++a<b;)this._guns[a].end()},upgradeGun:function(a,b){var c=this._deltaGunParam(a);!isNaN(b)&&0<b?this.scheduleOnce(function(){this._deltaGunParam(c)},b):this._deltaGunParam(c)},_deltaGunParam:function(a){if(0!=this._guns.length){var b={},c=0,d;for(d in a)c=this._guns[0].param[d]+a[d],0>=c?delete a[d]:(b[d]=-a[d],a[d]=c);c=this._guns.length;for(d=null;c--;)d=this._guns[c],d.updateParam(a);return b}},onDie:function(){this.stopShoot();flax.callModuleFunction(this,
"onDie");this.ownerBody?this.ownerBody.destroy():this.destroy()}};flax.Gunner=flax.Animator.extend(flax._gunnerDefine);window.flax.Gunner=flax.Gunner;flax.MCGunner=flax.MovieClip.extend(flax._gunnerDefine);window.flax.MCGunner=flax.MCGunner;flax.addModule(flax.Gunner,flax.HealthModule,!1);flax.addModule(flax.MCGunner,flax.HealthModule,!1);_p=flax.Gunner.prototype;cc.defineGetterSetter(_p,"gunParam",_p.getGunParam,_p.setGunParam);_p=flax.MCGunner.prototype;
cc.defineGetterSetter(_p,"gunParam",_p.getGunParam,_p.setGunParam);flax.Gunner.create=function(a,b){var c=new flax.Gunner(a,b);c.clsName="flax.Gunner";return c};flax.MCGunner.create=function(a,b){var c=new flax.MCGunner(a,b);c.clsName="flax.MCGunner";return c};flax.ScrollingBG=cc.Node.extend({name:null,onScrolledOver:null,_loop:!0,_bg0:null,_bg1:null,_sources:null,_scrollingIndex:0,_scrolling:!1,_paused:!1,_speedX:0,_speedY:0,_d:1,_size:null,_x0:0,_y0:0,ctor:function(a,b,c){this._super();this._sources=[];this.onScrolledOver=new signals.Signal;a&&this.addSource(a,b,c)},onExit:function(){this._super();this.onScrolledOver.removeAll()},addSource:function(a,b,c){this._sources.push({source:a,assetID:b,isTile:c});null==this._bg0&&(this._bg0=this._createNextBG())},
_createNextBG:function(){this._scrollingIndex>this._sources.length-1&&(this._scrollingIndex=0);var a=this._sources[this._scrollingIndex];this._scrollingIndex++;var b=null;if(null!=a.assetID)b=!0!==a.isTile?flax.assetsManager.createDisplay(a.source,a.assetID,null,!0):new flax.TiledImage(a.source,a.assetID);else if(a.source)if(flax.isFlaxDisplay(a.source))a.source.parent&&a.source.parent.addChild(this,a.source.zIndex),this.name=a.source.name,this.parent&&(this.parent[this.name]=this),this.setPosition(a.source.getPosition()),
b=flax.assetsManager.cloneDisplay(a.source),a.source.removeFromParent();else if(flax.isImageFile(a.source))b=new cc.Sprite(a.source);else throw"Not supported source type!";else throw"Arguments is not valid!";b.setAnchorPoint(0,0);this.addChild(b);null==this._size&&(this._size=b.getContentSize(),this.setContentSize(this._size));return b},reset:function(){this._paused=!1;this._scrolling&&(this._scrolling=!1,this._speedX=this._speedY=0,this._bg0.destroy?this._bg0.destroy():this._bg0.removeFromParent(),
this._bg0=null,this._bg1.destroy?this._bg1.destroy():this._bg1.removeFromParent(),this._bg1=null,this._scrollingIndex=0,null==this._bg0&&(this._bg0=this._createNextBG()),this._bg0.setPosition(this._x0,this._y0),this.unscheduleUpdate())},startXScroll:function(a,b){0==a||null==this._bg0||this._scrolling||(this._scrolling=!0,this._loop=!1!==b,this._speedX=a,this._speedY=0,this._d=0<this._speedX?1:-1,this._resetScroll(),this.scheduleUpdate())},startYScroll:function(a,b){0==a||null==this._bg0||this._scrolling||
(this._scrolling=!0,this._loop=!1!==b,this._speedY=a,this._speedX=0,this._d=0<this._speedY?1:-1,this._resetScroll(),this.scheduleUpdate())},pauseScroll:function(){this._scrolling&&!this._paused&&(this._paused=!0,this.unscheduleUpdate())},resumeScroll:function(){this._scrolling&&this._paused&&(this._paused=!1,this.scheduleUpdate())},_resetScroll:function(){this._bg0.setPosition(this._x0,this._y0);null==this._bg1&&(this._bg1=this._createNextBG());0!=this._speedX?this._bg1.x=-this._d*(this._size.width-
1):this._bg1.y=-this._d*(this._size.height-1)},update:function(a){if(0==this._size.width*this._size.height)this._size=this._bg0.getContentSize(),0!=this._size.width*this._size.height&&(this.setContentSize(this._size),this._resetScroll());else{var b=!1;0!=this._speedX?(a*=this._speedX,this._bg0.x+=a,this._bg1.x+=a,a=this._size.width-this._bg0.x*this._d,0>=a&&(this._bg0.x+=this._d*a,this._bg1.x+=this._d*a,b=!0)):0!=this._speedY&&(a*=this._speedY,this._bg0.y+=a,this._bg1.y+=a,a=this._size.height-this._bg0.y*
this._d,0>=a&&(this._bg0.y+=this._d*a,this._bg1.y+=this._d*a,b=!0));b&&(!this._loop&&this._scrollingIndex>this._sources.length-1?(this.onScrolledOver.dispatch(),this.pauseScroll()):(this._bg0.destroy?this._bg0.destroy():this._bg0.removeFromParent(),this._bg0=this._bg1,this._bg1=this._createNextBG(),this._resetScroll()))}},getRect:function(){0==this._size.width*this._size.height&&(this._size=this._bg0.getContentSize(),0!=this._size.width*this._size.height&&this.setContentSize(this._size));return cc.rect(0,
0,this._size.width,this._size.height)}});flax.ScrollingBG.create=function(a,b,c){return new flax.ScrollingBG(a,b,c)};flax._scrollPaneDefine={_viewRect:null,onEnter:function(){this._super();(this._viewRect=this.getCollider("view").getRect(!0))?flax.inputManager.addListener(null,this._startDrag,InputType.press,this):cc.log("If you want me scrollable, please set collider__view for me!")},scrollToCenter:function(a,b){var c=cc.visibleRect.center,c=this.parent.convertToNodeSpace(c),d=this.convertToWorldSpace(a.getPosition?a.getPosition():a),d=this.parent.convertToNodeSpace(d),c=cc.pSub(c,d),c=this._validatePos(this.x+
c.x,this.y+c.y);0<b?this.runAction(cc.MoveTo.create(b,c)):this.setPosition(c)},_startDrag:function(a,b){this.scheduleOnce(function(){flax.inputManager.addListener(null,this._drag,InputType.move,this);flax.inputManager.addListener(null,this._stopDrag,InputType.up,this)},0.01)},_drag:function(a,b){var c=a.getDelta();this._viewRect.width>=this.width&&(c.x=0);this._viewRect.height>=this.height&&(c.y=0);c=this._validatePos(this.x+c.x,this.y+c.y);this.x=c.x;this.y=c.y},_stopDrag:function(a,b){flax.inputManager.removeListener(null,
this._drag,InputType.move);flax.inputManager.removeListener(null,this._stopDrag,InputType.up)},_validatePos:function(a,b){a=Math.max(this._viewRect.x+this._viewRect.width-this.width,a);a=Math.min(this._viewRect.x,a);b=Math.max(this._viewRect.y+this._viewRect.height-this.height,b);b=Math.min(this._viewRect.y,b);return cc.p(a,b)}};flax.ScrollPane=flax.Animator.extend(flax._scrollPaneDefine);flax.ScrollPane.create=function(a,b){return new flax.ScrollPane(a,b)};window.flax.ScrollPane=flax.ScrollPane;
flax.MCScrollPane=flax.MovieClip.extend(flax._scrollPaneDefine);flax.MCScrollPane.create=function(a,b){return new flax.MCScrollPane(a,b)};window.flax.MCScrollPane=flax.MCScrollPane;flax.TiledImage=cc.SpriteBatchNode.extend({tileMap:null,tileWidthOffset:0,tileHeightOffset:0,assetsFile:null,assetID:null,_mapWidth:0,_mapHeight:0,ctor:function(a,b,c,d){var e=cc.path.changeBasename(a,".png");cc.SpriteBatchNode.prototype.ctor.call(this,e);this.tileMap=new flax.TileMap;this.setTileSource(a,b);c||(c=cc.visibleRect.width);d||(d=cc.visibleRect.height);this.setSize(c,d)},setTileSource:function(a,b){if(this.assetsFile!=a||this.assetID!=b){this.assetsFile=a;this.assetID=b;var c=flax.assetsManager.createDisplay(this.assetsFile,
this.assetID).getContentSize();this.tileMap.setTileSize(c.width+this.tileWidthOffset,c.height+this.tileHeightOffset);0<this._mapWidth*this._mapHeight&&(0<this.getChildrenCount()&&this._updateTileImg(),this._updateSize())}},setSize:function(a,b){if(a!=this._mapWidth||b!=this._mapHeight)this._mapWidth=a,this._mapHeight=b,this.assetsFile&&this._updateSize()},_updateTileImg:function(){for(var a=null,b=this.getChildrenCount(),c=-1;++c<b;)a=this.children[c],a.setSource(this.assetsFile,this.assetID),this.tileMap.snapToTile(a,
a.tx,a.ty)},_updateSize:function(){var a=this.tileMap.setMapSizePixel(this._mapWidth,this._mapHeight),b,c=a[0].length;if(0<c){var d;for(b=-1;++b<c;)d=a[0][b],d.destroy?d.destroy():d.removeFromParent()}c=a[1].length;if(0<c)for(b=-1;++b<c;)this._createTile(a[1][b][0],a[1][b][1]);this.setContentSize(this.tileMap.getMapSizePixel())},_createTile:function(a,b){var c=flax.assetsManager.createDisplay(this.assetsFile,this.assetID,{parent:this},!0);c.setAnchorPoint(0.5,0.5);this.tileMap.snapToTile(c,a,b,!0);
return c}});EIGHT_DIRECT_VALUE=[[0,1],[0,-1],[-1,0],[1,0],[-1,1],[1,1],[1,-1],[-1,-1]];var LinkFinder={};window.LinkFinder=LinkFinder;LinkFinder.map=null;LinkFinder.blocks=null;LinkFinder.findLink=function(a,b,c,d){var e=null,e=a==c||b==d?LinkFinder._checkDirectLink(a,b,c,d):LinkFinder._checkOneLink(a,b,c,d);null==e&&(e=LinkFinder._checkTwoLink(a,b,c,d));return e};
LinkFinder.shuffle=function(a){var b=this.map.getAllObjects(),c=b.concat(),d=-1;if(this.blocks&&this.blocks.length)for(c=[];++d<b.length;){var e=b[d];-1==this.blocks.indexOf(e)&&c.push(e)}flax.shuffleArray(c);d=-1;for(b=c.length/2;++d<b;){var e=c[d],f=c[d+b],g=e.getPosition();!1!==a?(e.runAction(cc.MoveTo.create(0.2,f.getPosition())),f.runAction(cc.MoveTo.create(0.2,g))):(e.setPosition(f.getPosition()),f.setPosition(g))}};
LinkFinder.findAvailableLink=function(a){var b=this.map.getAllObjects(),c=b.length;if(0==c)return null;for(var d,e,f=null,g=[],k=null,l=0;l<c-1;l++)if(d=b[l],!(this.blocks&&-1<this.blocks.indexOf(d))){var n=0==g.length;null==k&&(k=d);for(var m=l+1;m<c;m++)if(e=b[m],!(this.blocks&&-1<this.blocks.indexOf(e)))if(e.assetID==d.assetID){if(LinkFinder.findLink(d.tx,d.ty,e.tx,e.ty))return[d,e];n&&g.push(e)}else n&&null==f&&LinkFinder.findLink(d.tx,d.ty,e.tx,e.ty)&&(f=e)}if(0==g.length)return null;b=g[Math.floor(g.length*
Math.random())];c=cc.p(b.getPosition());if(null==f){f=this._findEmptyNeighbor(k.tx,k.ty);if(null==f)throw"Dead map!!!!";c=this.map.getTiledPosition(f.x,f.y);b.parent&&(c=b.parent.convertToNodeSpace(c));!0===a?b.runAction(cc.MoveTo.create(0.2,c)):b.setPosition(c)}else!0===a?(b.runAction(cc.MoveTo.create(0.2,f.getPosition())),f.runAction(cc.MoveTo.create(0.2,c))):(b.setPosition(f.getPosition()),f.setPosition(c));return[k,b]};
LinkFinder._findEmptyNeighbor=function(a,b){for(var c=null,d=0;4>d&&(c=EIGHT_DIRECT_VALUE[d],c=cc.p(a+c[0],b+c[1]),!this.map.isEmptyTile(c.x,c.y));d++);return c};LinkFinder._checkDirectLink=function(a,b,c,d){if(a==c&&b==d)return null;if(a==c){for(var e=!0,f=0<d-b?1:-1,g=b+f;g!=d;){if(!this.map.isEmptyTile(a,g)){e=!1;break}g+=f}if(e)return[new cc.p(a,b),new cc.p(c,d)]}if(b==d){e=!0;f=0<c-a?1:-1;for(g=a+f;g!=c;){if(!this.map.isEmptyTile(g,b)){e=!1;break}g+=f}if(e)return[new cc.p(a,b),new cc.p(c,d)]}return null};
LinkFinder._checkOneLink=function(a,b,c,d){if(a==c||b==d)return null;if(this.map.isEmptyTile(a,d)){var e=LinkFinder._checkDirectLink(a,b,a,d);if(e&&(e=LinkFinder._checkDirectLink(a,d,c,d)))return[new cc.p(a,b),new cc.p(a,d),new cc.p(c,d)]}return this.map.isEmptyTile(c,b)&&(e=LinkFinder._checkDirectLink(a,b,c,b))&&(e=LinkFinder._checkDirectLink(c,b,c,d))?[new cc.p(a,b),new cc.p(c,b),new cc.p(c,d)]:null};
LinkFinder._checkTwoLink=function(a,b,c,d){if(a==c&&b==d)return null;var e=0<=c-a?1:-1,f=0<=d-b?1:-1,g=LinkFinder._twoLinkSearch(a,b,c,d,e,f);null==g&&(g=LinkFinder._twoLinkSearch(a,b,c,d,-e,-f));null!=g&&g.unshift(new cc.p(a,b));return g};
LinkFinder._twoLinkSearch=function(a,b,c,d,e,f){for(var g=null,k=a+e,l=b+f,n=!1,m=!1;!n||!m;){if(!n&&(n=!this.map.isEmptyTile(k,b),!n)){g=LinkFinder._checkOneLink(k,b,c,d);if(null!=g)break;k+=e}if(!m&&(m=!this.map.isEmptyTile(a,l),!m)){g=LinkFinder._checkOneLink(a,l,c,d);if(null!=g)break;l+=f}}return g};var HEX_NUM="0123456789ABCDEF",COLOR_WHITE=cc.color(255,255,255),COLOR_BLACK=cc.color(0,0,0),COLOR_RED=cc.color(255,0,0),COLOR_GREEN=cc.color(0,255,0),COLOR_BLUE=cc.color(0,0,255),COLOR_GRAY=cc.color(128,128,128);function hexToRgb(a){var b="#"==a.charAt(0)?a.substring(1,7):a;a=parseInt(b.substring(0,2),16);var c=parseInt(b.substring(2,4),16),b=parseInt(b.substring(4,6),16);return[a,c,b]}function randomColor(){var a=hsvToRgb(Math.random(),0.9725,1);return rgbToHex(a[0],a[1],a[2]).toUpperCase()}
function rgbToHex(a,b,c){return _toHex(a)+_toHex(b)+_toHex(c)}function rgbToHsl(a,b,c){a/=255;b/=255;c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f,g=(d+e)/2;if(d==e)f=e=0;else{var k=d-e,e=0.5<g?k/(2-d-e):k/(d+e);switch(d){case a:f=(b-c)/k+(b<c?6:0);break;case b:f=(c-a)/k+2;break;case c:f=(a-b)/k+4}f/=6}return[f,e,g]}
function hslToRgb(a,b,c){if(0==b)c=b=a=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},e=0.5>c?c*(1+b):c+b-c*b,f=2*c-e;c=d(f,e,a+1/3);b=d(f,e,a);a=d(f,e,a-1/3)}return[255*c,255*b,255*a]}function rgbToHsv(a,b,c){a/=255;b/=255;c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f,g=d-e;if(d==e)f=0;else{switch(d){case a:f=(b-c)/g+(b<c?6:0);break;case b:f=(c-a)/g+2;break;case c:f=(a-b)/g+4}f/=6}return[f,0==d?0:g/d,d]}
function hsvToRgb(a,b,c){var d,e,f,g=Math.floor(6*a),k=6*a-g;a=c*(1-b);var l=c*(1-k*b);b=c*(1-(1-k)*b);switch(g%6){case 0:d=c;e=b;f=a;break;case 1:d=l;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=l;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c,e=a,f=l}return[255*d,255*e,255*f]}function darkenHexColor(a,b){var c=hexToRgb(a),c=rgbToHsl(c[0],c[1],c[2]);c[2]-=b;c=hslToRgb(c[0],c[1],c[2]);return rgbToHex(c[0],c[1],c[2])}
function _toHex(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return HEX_NUM.charAt((a-a%16)/16)+HEX_NUM.charAt(a%16)};